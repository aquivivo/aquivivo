<!doctype html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Sample A2 lessons â†’ Firestore (AquiVivo)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../assets/css/styles.css?v=20260209" />
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      button {
        padding: 12px 16px;
        font-weight: 900;
        cursor: pointer;
      }
      .box {
        margin-top: 12px;
        padding: 12px;
        border: 1px solid var(--border-light);
        border-radius: 10px;
      }
      .ok {
        color: var(--success-ink);
        font-weight: 900;
      }
      .err {
        color: var(--danger-ink);
        font-weight: 900;
      }
      code {
        background: #f3f4f6;
        padding: 2px 6px;
        border-radius: 6px;
      }
      .muted {
        color: var(--ink-muted);
      }
    </style>
  </head>
  <body>
    <div
      style="
        background: var(--yellow);
        color: var(--blue);
        padding: 8px;
        text-align: center;
        font-size: 12px;
        font-weight: 700;
        margin-bottom: 14px;
      "
    >
      SesiÃ³n activa:
      <strong id="sessionEmail" style="color: var(--blue); font-weight: 900"
        >Cargando...</strong
      >
    </div>

    <h2>ğŸ”§ Sample: 2 lecciones A2 (gramÃ¡tica + ejercicios + fichas)</h2>
    <p>
      Crea 2 temas demo en <code>courses</code>, su lecciÃ³n en
      <code>course_meta</code> y ejercicios en <code>exercises</code>.
    </p>
    <p class="muted">
      Requiere admin: <code>aquivivo.pl@gmail.com</code>
    </p>

    <button id="importBtn">IMPORTAR A2 DEMO (idempotente)</button>
    <div id="log" class="box">Status: listo.</div>

    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js';
      import {
        getAuth,
        onAuthStateChanged,
      } from 'https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js';
      import {
        getFirestore,
        doc,
        setDoc,
        serverTimestamp,
      } from 'https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js';

      const firebaseConfig = {
        apiKey: 'AIzaSyBoa3Yf82CDW6k1FSwdeoQg-gBTjh9kVZM',
        authDomain: 'aquivivo-platform.firebaseapp.com',
        projectId: 'aquivivo-platform',
        storageBucket: 'aquivivo-platform.firebasestorage.app',
        messagingSenderId: '116115622011',
        appId: '1:116115622011:web:33a4a583eba4368071bade',
      };

      const ADMIN_EMAIL = 'aquivivo.pl@gmail.com';

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      const logEl = document.getElementById('log');
      const sessionEl = document.getElementById('sessionEmail');
      function log(msg, type = '') {
        logEl.innerHTML = `<div class="${type}">${msg}</div>`;
      }

      function esc(s) {
        return String(s || '')
          .replaceAll('&', '&amp;')
          .replaceAll('<', '&lt;')
          .replaceAll('>', '&gt;')
          .replaceAll('"', '&quot;')
          .replaceAll("'", '&#039;');
      }

      let IS_ADMIN = false;

      onAuthStateChanged(auth, (user) => {
        if (sessionEl) sessionEl.textContent = user?.email || '(sin sesiÃ³n)';
        IS_ADMIN =
          !!user &&
          String(user.email || '').toLowerCase() === ADMIN_EMAIL.toLowerCase();
        if (!IS_ADMIN) {
          log(
            `âŒ Zaloguj siÄ™ jako admin (${esc(ADMIN_EMAIL)}), potem wrÃ³Ä‡ na tÄ™ stronÄ™.`,
            'err',
          );
        }
      });

      const HTML_CAFE = `
        <h2>Objetivo</h2>
        <p>Hoy vas a pedir en una cafeterÃ­a en Polonia con frases naturales.</p>

        <h2>GramÃ¡tica rÃ¡pida: <i>PoproszÄ™ + biernik</i></h2>
        <p><b>PoproszÄ™</b> + objeto en <b>biernik</b> (accusativo):</p>
        <ul>
          <li>kawa â†’ <b>kawÄ™</b></li>
          <li>herbata â†’ <b>herbatÄ™</b></li>
          <li>woda â†’ <b>wodÄ™</b></li>
        </ul>

        <div class="card" style="padding:12px; margin:12px 0;">
          <div style="font-weight:900;">Ejemplo</div>
          <div style="margin-top:6px; line-height:1.6;">
            <b>PL:</b> PoproszÄ™ czarnÄ… kawÄ™ i sernik.<br/>
            <b>ES:</b> Quisiera un cafÃ© solo y un pastel de queso.
          </div>
        </div>

        <h2>Vocabulario clave</h2>
        <ul>
          <li><b>kawa</b> â€” cafÃ©</li>
          <li><b>herbata</b> â€” tÃ©</li>
          <li><b>woda niegazowana</b> â€” agua sin gas</li>
          <li><b>ciasto</b> â€” pastel</li>
        </ul>

        <h2>Mini diÃ¡logo</h2>
        <p>
          <b>A:</b> DzieÅ„ dobry. Co podaÄ‡?<br/>
          <b>B:</b> PoproszÄ™ czarnÄ… kawÄ™. I wodÄ™ niegazowanÄ…, proszÄ™.<br/>
          <b>A:</b> Jasne. CoÅ› jeszcze?<br/>
          <b>B:</b> To wszystko. DziÄ™kujÄ™.
        </p>
        <div class="hintSmall" style="margin-top:12px;">
          Dalej: zrÃ³b <b>Ejercicios</b>, potem przejdÅº do <b>Fichas</b>.
        </div>
      `;

      const HTML_TRANSPORTE = `
        <h2>Objetivo</h2>
        <p>Vas a moverte por la ciudad: metro, tranvÃ­a y billetes.</p>

        <h2>GramÃ¡tica rÃ¡pida: <i>na + miejscownik</i></h2>
        <p>
          Para hablar de ubicaciÃ³n en lugares â€œde superficieâ€ usamos <b>na</b> +
          <b>miejscownik</b>:
        </p>
        <ul>
          <li>na przystanku</li>
          <li>na dworcu</li>
          <li>na ulicy</li>
        </ul>

        <div class="card" style="padding:12px; margin:12px 0;">
          <div style="font-weight:900;">Ejemplo</div>
          <div style="margin-top:6px; line-height:1.6;">
            <b>PL:</b> Jestem na przystanku. PoproszÄ™ bilet.<br/>
            <b>ES:</b> Estoy en la parada. Quisiera un billete.
          </div>
        </div>

        <h2>Vocabulario clave</h2>
        <ul>
          <li><b>przystanek</b> â€” parada</li>
          <li><b>bilet</b> â€” billete</li>
          <li><b>tramwaj</b> â€” tranvÃ­a</li>
          <li><b>metro</b> â€” metro</li>
        </ul>

        <h2>Tip</h2>
        <p>En Polonia: <b>PoproszÄ™ bilet</b> es una frase sÃºper Ãºtil.</p>
      `;

      const DEMOS = [
        {
          id: 'A2_DEMO_CAFE_KRAKOW',
          level: 'A2',
          type: 'both',
          title: 'KrakÃ³w: En la cafeterÃ­a (DEMO)',
          desc: 'Biernik + pedir en una cafeterÃ­a. Ejercicios + fichas + voz.',
          slug: 'demo-cafe-krakow',
          icon: 'â˜•',
          order: 980,
          meta: {
            published: true,
            titleEs: 'KrakÃ³w: En la cafeterÃ­a',
            descriptionEs: 'Pedir con â€œPoproszÄ™â€ + biernik, con mini prÃ¡ctica.',
            durationMin: 10,
            html: HTML_CAFE,
            summary:
              'Aprendes a pedir en una cafeterÃ­a: formas en biernik + frases de cortesÃ­a.',
            vocab: [
              'PoproszÄ™â€¦',
              'kawa / herbatÄ™ / wodÄ™',
              'czarna â†’ czarnÄ…',
              'To wszystko.',
            ],
            homework:
              'Nagraj 1 minuto: co pides en una cafeterÃ­a (PL). Luego pide correcciÃ³n en la comunidad.',
          },
          exercises: [
            {
              id: 'A2__DEMO_CAFE__001',
              order: 1,
              type: 'Rellenar los espacios',
              prompt: 'PoproszÄ™ ___ kawÄ™.',
              answer: 'czarnÄ…',
              notes: 'kawa â†’ kawÄ™; czarna â†’ czarnÄ… (biernik, rodzaj Å¼eÅ„ski)',
              tags: ['demo', 'a2', 'grammar'],
            },
            {
              id: 'A2__DEMO_CAFE__002',
              order: 2,
              type: 'OpciÃ³n mÃºltiple',
              prompt: 'Elige la forma correcta: PoproszÄ™ ___ herbatÄ™.',
              options: ['A) dobra', 'B) dobrÄ…', 'C) dobry'],
              answer: 'B',
              notes: 'herbata (f) â†’ herbatÄ™; dobra â†’ dobrÄ…',
              tags: ['demo', 'a2', 'grammar'],
            },
            {
              id: 'A2__DEMO_CAFE__003',
              order: 3,
              type: 'Escuchar y completar los espacios',
              prompt: 'W Krakowie ___ dobrÄ… kawÄ™.',
              answer: 'pijÄ™',
              notes: 'Escucha (TTS) y completa.',
              tags: ['demo', 'a2', 'listening'],
            },
            {
              id: 'A2__DEMO_CAFE__004',
              order: 4,
              type: 'Escuchar y repetir',
              prompt: 'PowtÃ³rz: PoproszÄ™ jeszcze jednÄ… herbatÄ™, proszÄ™.',
              answer: '',
              notes: 'Escucha (TTS) y graba tu voz.',
              tags: ['demo', 'a2', 'speaking'],
            },
            {
              id: 'A2__DEMO_CAFE__005',
              order: 5,
              type: 'Tarjetas interactivas',
              prompt: 'Fichas del tema',
              options: [
                '1) PL: kawa | ES: cafÃ© | EX: PoproszÄ™ kawÄ™.',
                '2) PL: herbata | ES: tÃ© | EX: PoproszÄ™ herbatÄ™.',
                '3) PL: ciasto | ES: pastel | EX: To ciasto jest dobre.',
                '4) PL: woda niegazowana | ES: agua sin gas | EX: PoproszÄ™ wodÄ™ niegazowanÄ….',
              ],
              answer: '',
              notes: 'Abre â€œFichasâ€ para practicar tipo Quizlet.',
              tags: ['demo', 'a2', 'flashcards'],
            },
            {
              id: 'A2__DEMO_CAFE__006',
              order: 6,
              type: 'Test final del tema',
              prompt: 'Elige: PoproszÄ™ ___ wodÄ™.',
              options: ['A) zimna', 'B) zimnÄ…', 'C) zimny'],
              answer: 'B',
              notes: 'Test: biernik + przymiotnik (f).',
              tags: ['demo', 'a2', 'test'],
            },
          ],
        },
        {
          id: 'A2_DEMO_TRANSPORTE_WARSZAWA',
          level: 'A2',
          type: 'both',
          title: 'Warszawa: Transporte pÃºblico (DEMO)',
          desc: 'na + miejscownik. Billetes, parada, metro. Ejercicios + voz.',
          slug: 'demo-transporte-warszawa',
          icon: 'ğŸš‹',
          order: 990,
          meta: {
            published: true,
            titleEs: 'Varsovia: Transporte pÃºblico',
            descriptionEs: 'Frases Ãºtiles: na przystanku, poproszÄ™ bilet, etc.',
            durationMin: 10,
            html: HTML_TRANSPORTE,
            summary:
              'Aprendes frases bÃ¡sicas para moverte por la ciudad y usar â€œna + miejscownikâ€.',
            vocab: ['przystanek', 'bilet', 'tramwaj', 'metro', 'poproszÄ™'],
            homework:
              'Nagraj: 5 frases (PL) para ir al metro y comprar un billete.',
          },
          exercises: [
            {
              id: 'A2__DEMO_TRAN__001',
              order: 1,
              type: 'Rellenar los espacios',
              prompt: 'Jestem ___ przystanku.',
              answer: 'na',
              notes: 'na + miejscownik: na przystanku',
              tags: ['demo', 'a2', 'grammar'],
            },
            {
              id: 'A2__DEMO_TRAN__002',
              order: 2,
              type: 'OpciÃ³n mÃºltiple',
              prompt: 'Elige: IdÄ™ ___ metro.',
              options: ['A) do', 'B) na', 'C) w'],
              answer: 'B',
              notes: 'Frase natural: iÅ›Ä‡ na metro.',
              tags: ['demo', 'a2', 'grammar'],
            },
            {
              id: 'A2__DEMO_TRAN__003',
              order: 3,
              type: 'Escuchar y completar los espacios',
              prompt: 'Bilet kosztuje ___ zÅ‚ote.',
              answer: 'cztery',
              notes: 'Escucha (TTS) y completa.',
              tags: ['demo', 'a2', 'listening'],
            },
            {
              id: 'A2__DEMO_TRAN__004',
              order: 4,
              type: 'Escuchar y repetir',
              prompt: 'PowtÃ³rz: PoproszÄ™ bilet ulgowy, proszÄ™.',
              answer: '',
              notes: 'Escucha (TTS) y graba tu voz.',
              tags: ['demo', 'a2', 'speaking'],
            },
            {
              id: 'A2__DEMO_TRAN__005',
              order: 5,
              type: 'Tarjetas interactivas',
              prompt: 'Fichas del tema',
              options: [
                '1) PL: przystanek | ES: parada | EX: Jestem na przystanku.',
                '2) PL: bilet | ES: billete | EX: PoproszÄ™ bilet.',
                '3) PL: tramwaj | ES: tranvÃ­a | EX: JadÄ™ tramwajem.',
                '4) PL: metro | ES: metro | EX: IdÄ™ na metro.',
              ],
              answer: '',
              notes: 'Abre â€œFichasâ€ para practicar.',
              tags: ['demo', 'a2', 'flashcards'],
            },
            {
              id: 'A2__DEMO_TRAN__006',
              order: 6,
              type: 'Test final del tema',
              prompt: 'Elige: Jestem ___ przystanku.',
              options: ['A) do', 'B) na', 'C) w'],
              answer: 'B',
              notes: 'Test: na + miejscownik.',
              tags: ['demo', 'a2', 'test'],
            },
          ],
        },
      ];

      async function upsertTopic(demo) {
        const courseRef = doc(db, 'courses', demo.id);
        await setDoc(
          courseRef,
          {
            level: demo.level,
            type: demo.type,
            title: demo.title,
            name: demo.title,
            desc: demo.desc,
            subtitle: demo.desc,
            slug: demo.slug,
            icon: demo.icon,
            order: demo.order,
            free: false,
            updatedAt: serverTimestamp(),
            createdAt: serverTimestamp(),
          },
          { merge: true },
        );

        const metaRef = doc(db, 'course_meta', `${demo.level}__${demo.id}`);
        await setDoc(
          metaRef,
          {
            level: demo.level,
            courseId: demo.id,
            published: demo.meta.published === true,
            titleEs: demo.meta.titleEs,
            descriptionEs: demo.meta.descriptionEs,
            durationMin: demo.meta.durationMin || null,
            html: demo.meta.html,
            summary: demo.meta.summary || '',
            vocab: demo.meta.vocab || [],
            resources: [],
            homework: demo.meta.homework || '',
            updatedAt: serverTimestamp(),
            createdAt: serverTimestamp(),
          },
          { merge: true },
        );

        for (const ex of demo.exercises) {
          const exRef = doc(db, 'exercises', ex.id);
          await setDoc(
            exRef,
            {
              level: demo.level,
              topicId: demo.id,
              topicSlug: demo.slug,
              order: ex.order,
              type: ex.type,
              prompt: ex.prompt,
              options: ex.options || [],
              answer: ex.answer || '',
              notes: ex.notes || '',
              tags: ex.tags || [],
              category: 'both',
              updatedAt: serverTimestamp(),
              createdAt: serverTimestamp(),
            },
            { merge: true },
          );
        }
      }

      document.getElementById('importBtn').onclick = async () => {
        if (!IS_ADMIN) {
          alert('Nie jesteÅ› adminem.');
          return;
        }
        try {
          log('â³ ImportujÄ™ demo A2...', '');
          for (const demo of DEMOS) {
            await upsertTopic(demo);
          }
          log(
            'âœ… Gotowe. OtwÃ³rz: <code>course.html?level=A2</code> i znajdziesz 2 tematy (DEMO).',
            'ok',
          );
        } catch (e) {
          console.error(e);
          log('âŒ BÅ‚Ä…d importu. SprawdÅº konsolÄ™.', 'err');
        }
      };
    </script>
  </body>
</html>

