<!doctype html>
<html lang="es" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Polaco - Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&amp;family=Playfair+Display:wght@700;900&amp;display=swap" rel="stylesheet">
  <style>
    /* =========================
       AQUI VIVO â€“ DESIGN SYSTEM
       ========================= */
    
    /* ---------- KOLORY ---------- */
    :root {
      --yellow-main: #FCD116;
      --yellow-light: #FFD700;
      --blue-main: #003893;
      --blue-dark: #001a4d;
      --blue-light: #0055CC;
      --red-main: #CE1126;
      --red-light: #FF1E3C;
      --red-dark: #A00E1E;
      --white: #ffffff;
      --gray-text: #6b7280;
      --gray-light: #f3f4f6;
    }
    
    body {
      box-sizing: border-box;
      font-family: 'Montserrat', sans-serif;
    }
    
    * {
      box-sizing: border-box;
    }
    
    .font-display {
      font-family: 'Playfair Display', serif;
    }
    
    .glow-text {
      text-shadow: 0 0 20px rgba(252, 209, 22, 0.5);
    }
    
    /* ---------- GRADIENTY ---------- */
    .gradient-yellow {
      background: linear-gradient(135deg, var(--yellow-main) 0%, var(--yellow-light) 100%);
    }
    
    .gradient-red {
      background: linear-gradient(135deg, var(--red-main) 0%, var(--red-light) 100%);
    }
    
    .gradient-blue {
      background: linear-gradient(135deg, var(--blue-main) 0%, var(--blue-light) 100%);
    }
    
    /* ---------- KARTY ---------- */
    .card {
      background: white;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      transition: all 0.4s ease;
    }
    
    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
    }
    
    .card-yellow {
      background: linear-gradient(135deg, var(--yellow-main) 0%, var(--yellow-light) 100%);
      box-shadow: 0 10px 40px rgba(252, 209, 22, 0.3);
    }
    
    .card-yellow:hover {
      box-shadow: 0 20px 60px rgba(252, 209, 22, 0.4);
    }
    
    .card-red {
      background: linear-gradient(135deg, var(--red-main) 0%, var(--red-light) 100%);
      box-shadow: 0 10px 40px rgba(206, 17, 38, 0.3);
    }
    
    .card-red:hover {
      box-shadow: 0 20px 60px rgba(206, 17, 38, 0.4);
    }
    
    .card-blue {
      background: linear-gradient(135deg, var(--blue-main) 0%, var(--blue-light) 100%);
      box-shadow: 0 10px 40px rgba(0, 56, 147, 0.3);
    }
    
    .card-blue:hover {
      box-shadow: 0 20px 60px rgba(0, 56, 147, 0.4);
    }
    
    /* ---------- PRZYCISKI ---------- */
    .btn-yellow {
      background: linear-gradient(135deg, var(--yellow-main) 0%, var(--yellow-light) 100%);
      color: var(--blue-main);
      font-weight: 700;
      padding: 14px 28px;
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(252, 209, 22, 0.4);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      display: inline-block;
      text-align: center;
    }
    
    .btn-yellow:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(252, 209, 22, 0.6);
    }
    
    .btn-red {
      background: linear-gradient(135deg, var(--red-main) 0%, var(--red-dark) 100%);
      color: white;
      font-weight: 700;
      padding: 14px 28px;
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(206, 17, 38, 0.4);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      display: inline-block;
      text-align: center;
    }
    
    .btn-red:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(206, 17, 38, 0.6);
    }
    
    .btn-white-outline {
      border: 3px solid white;
      color: white;
      font-weight: 700;
      padding: 16px 32px;
      border-radius: 16px;
      background: transparent;
      transition: all 0.3s ease;
    }
    
    .btn-white-outline:hover {
      background: white;
      color: var(--blue-main);
    }
    
    /* ---------- PASKI AKCENTOWE ---------- */
    .accent-yellow {
      position: relative;
      padding-left: 24px;
    }
    
    .accent-yellow::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 6px;
      background: var(--yellow-main);
      border-radius: 3px;
    }
    
    .accent-red {
      position: relative;
      padding-left: 24px;
    }
    
    .accent-red::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 6px;
      background: var(--red-main);
      border-radius: 3px;
    }
    
    /* ---------- PRICE TAG ---------- */
    .price-tag {
      background: linear-gradient(135deg, var(--yellow-main) 0%, var(--yellow-light) 100%);
      color: var(--blue-main);
      padding: 10px 20px;
      border-radius: 12px;
      font-weight: 800;
      display: inline-block;
      box-shadow: 0 4px 16px rgba(252, 209, 22, 0.4);
    }
    
    /* ---------- IKONY W KÃ“ÅKACH ---------- */
    .icon-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      margin: 0 auto;
      background: linear-gradient(135deg, var(--yellow-main) 0%, var(--yellow-light) 100%);
      box-shadow: 0 8px 24px rgba(252, 209, 22, 0.4);
    }
    
    /* ---------- ANIMACJA FLOAT ---------- */
    .floating {
      animation: floating 3s ease-in-out infinite;
    }
    
    @keyframes floating {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--yellow-main);
      box-shadow: 0 0 0 3px rgba(252, 209, 22, 0.15);
    }
    
    .level-card {
      transition: all 0.4s ease;
    }
    
    .topic-tile {
      transition: all 0.4s ease;
    }
    
    .topic-tile:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
    }
    
    .popup-overlay {
      background: rgba(0, 26, 77, 0.85);
      backdrop-filter: blur(12px);
    }
    
    .accordion-arrow {
      transition: transform 0.2s ease;
    }
    
    .accordion-arrow.open {
      transform: rotate(180deg);
    }
    
    .admin-link {
      font-size: 11px;
    }
    
    .filter-pill {
      cursor: pointer;
    }
    
    .filter-pill.active {
      background-color: var(--yellow-main) !important;
      border-color: var(--yellow-main) !important;
      color: var(--blue-main) !important;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full" style="background: linear-gradient(180deg, #001a4d 0%, #003893 50%, #001a4d 100%);">
  <div id="app" class="h-full overflow-auto">
   <div class="max-w-4xl mx-auto px-4 py-8"><!-- Header -->
    <header class="text-center mb-8 mt-8">
     <h1 id="main-title" class="font-display text-5xl font-bold mb-2 glow-text" style="color: var(--yellow-main);">Polaco</h1>
     <p id="main-subtitle" class="text-lg" style="color: rgba(255, 255, 255, 0.8);">Curso interactivo para extranjeros</p>
    </header><!-- Search Bar -->
    <div class="mb-6">
     <div class="relative">
      <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5" style="color: var(--yellow-main);" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg><input type="text" id="search-input" placeholder="Buscar temaâ€¦" class="search-input w-full py-4 pl-12 pr-4 text-base rounded-2xl border-2" style="background-color: rgba(255, 255, 255, 0.95); border-color: var(--yellow-main); color: var(--blue-main);">
     </div>
    </div><!-- Exercise Finder -->
    <div class="mb-6">
     <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <div><label class="block text-xs font-medium mb-1.5 ml-1" style="color: var(--yellow-main);">Tipo de ejercicio</label> <select id="exercise-type-filter" onchange="applyFilters()" class="w-full py-3 px-4 rounded-xl border-2 text-sm font-medium cursor-pointer" style="background-color: rgba(255, 255, 255, 0.95); border-color: var(--yellow-main); color: var(--blue-main);"> <option value="">ğŸ“š Todos los tipos de ejercicios</option> <option value="Rellenar los espacios">âœï¸ Rellenar los espacios</option> <option value="Relacionar palabra con imagen">ğŸ–¼ï¸ Relacionar palabra con imagen</option> <option value="Relacionar palabra con traducciÃ³n">ğŸ”„ Relacionar palabra con traducciÃ³n</option> <option value="Elegir la palabra correcta">â˜‘ï¸ Elegir la palabra correcta</option> <option value="Tarjetas interactivas">ğŸƒ Tarjetas interactivas</option> <option value="Agrupar palabras">ğŸ“¦ Agrupar palabras</option> <option value="Verdadero o falso">âœ… Verdadero o falso</option> <option value="Completar la frase con una imagen">ğŸ–¼ï¸ Completar la frase con una imagen</option> <option value="Juego de memoria (pares)">ğŸ§  Juego de memoria (pares)</option> <option value="OpciÃ³n mÃºltiple">ğŸ”˜ OpciÃ³n mÃºltiple</option> <option value="Completar la forma correcta">ğŸ“ Completar la forma correcta</option> <option value="Elegir la forma correcta">âœ”ï¸ Elegir la forma correcta</option> <option value="Transformaciones">ğŸ”€ Transformaciones</option> <option value="Relacionar pregunta con respuesta">â“ Relacionar pregunta con respuesta</option> <option value="Ordenar palabras para formar una frase">ğŸ”¤ Ordenar palabras para formar una frase</option> <option value="Corregir errores">ğŸ” Corregir errores</option> <option value="Unir dos partes de la frase">ğŸ§© Unir dos partes de la frase</option> <option value="Completar con preposiciÃ³n o terminaciÃ³n">â• Completar con preposiciÃ³n o terminaciÃ³n</option> <option value="OpciÃ³n Ãºnica">1ï¸âƒ£ OpciÃ³n Ãºnica</option> <option value="Escribir tu propia respuesta">âœï¸ Escribir tu propia respuesta</option> <option value="Repetir despuÃ©s del narrador">ğŸ—£ï¸ Repetir despuÃ©s del narrador</option> <option value="Completar la frase con tu voz">ğŸ¤ Completar la frase con tu voz</option> <option value="Responder a una pregunta">ğŸ’¬ Responder a una pregunta</option> <option value="Describir una imagen">ğŸ¨ Describir una imagen</option> <option value="Juego de roles">ğŸ­ Juego de roles</option> <option value="Mini-monÃ³logo">ğŸ“£ Mini-monÃ³logo</option> <option value="DiÃ¡logo semiabierto">ğŸ’­ DiÃ¡logo semiabierto</option> <option value="Decirlo de otra manera">ğŸ” Decirlo de otra manera</option> <option value="Escuchar y elegir la respuesta">ğŸ‘‚ Escuchar y elegir la respuesta</option> <option value="Escuchar y completar los espacios">ğŸ§ Escuchar y completar los espacios</option> <option value="Escuchar y marcar verdadero o falso">ğŸ‘‚ Escuchar y marcar verdadero o falso</option> <option value="Escuchar y relacionar personas">ğŸ‘¥ Escuchar y relacionar personas</option> <option value="Escuchar y ordenar la secuencia">ğŸ”¢ Escuchar y ordenar la secuencia</option> <option value="Dictado con audio">ğŸ“» Dictado con audio</option> <option value="Escuchar y repetir">ğŸ”Š Escuchar y repetir</option> <option value="DiÃ¡logo interactivo">ğŸ’¬ DiÃ¡logo interactivo</option> <option value="MisiÃ³n del dÃ­a">ğŸ¯ MisiÃ³n del dÃ­a</option> <option value="Quiz situacional">ğŸ² Quiz situacional</option> <option value="Video con preguntas">ğŸ¬ Video con preguntas</option> </select>
      </div>
      <div><label class="block text-xs font-medium mb-1.5 ml-1" style="color: var(--yellow-main);">Nivel</label> <select id="level-filter" onchange="applyFilters()" class="w-full py-3 px-4 rounded-xl border-2 text-sm font-medium cursor-pointer" style="background-color: rgba(255, 255, 255, 0.95); border-color: var(--yellow-main); color: var(--blue-main);"> <option value="">ğŸŒ Todos los niveles</option> <option value="A1">ğŸŒ± Nivel A1</option> <option value="A2">ğŸŒ¿ Nivel A2</option> <option value="B1">ğŸŒ³ Nivel B1</option> <option value="B2">ğŸ† Nivel B2</option> </select>
      </div>
     </div>
     <div class="mt-3 text-center"><span id="filter-count" class="text-sm font-medium" style="color: var(--yellow-main);"></span>
     </div>
    </div><!-- Admin Button and Social Links -->
    <div class="flex justify-between items-center mb-6">
     <div class="flex-1"></div>
     <div class="flex items-center gap-3"><a href="https://instagram.com/sacariooo" target="_blank" rel="noopener noreferrer" class="w-10 h-10 rounded-full flex items-center justify-center hover:opacity-80 transition-opacity" style="background: linear-gradient(135deg, #f58529, #dd2a7b, #8134af);" title="@sacariooo">
       <svg class="w-5 h-5" style="color: white;" viewbox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
       </svg></a> <a href="https://tiktok.com/@latip0l" target="_blank" rel="noopener noreferrer" class="w-10 h-10 rounded-full flex items-center justify-center hover:opacity-80 transition-opacity" style="background-color: #000000;" title="@latip0l">
       <svg class="w-5 h-5" style="color: white;" viewbox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z" />
       </svg></a> <a href="mailto:aquivivo.pl@gmail.com?subject=Consulta sobre el curso de polaco&amp;body=Â¡Hola!%0D%0A%0D%0AMe gustarÃ­a recibir mÃ¡s informaciÃ³n sobre tus clases de polaco. Estoy interesado/a en aprender el idioma y me encantarÃ­a conocer las opciones disponibles.%0D%0A%0D%0AÂ¿PodrÃ­as contarme sobre los horarios, metodologÃ­a y tarifas?%0D%0A%0D%0AQuedo atento/a a tu respuesta.%0D%0A%0D%0AÂ¡Saludos!" class="w-10 h-10 rounded-full flex items-center justify-center hover:opacity-80 transition-opacity" style="background-color: #ea4335;" title="aquivivo.pl@gmail.com">
       <svg class="w-5 h-5" style="color: white;" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
       </svg></a>
     </div>
     <div class="flex-1 flex justify-end"><button id="admin-btn" class="px-4 py-2 text-sm rounded-lg font-medium transition-opacity hover:opacity-80" style="color: var(--yellow-main); opacity: 0.6; background: transparent;"> ğŸ” Modo Admin </button>
     </div>
    </div><!-- Level Cards Container -->
    <div id="levels-container" class="space-y-4"><!-- Level cards will be rendered here -->
    </div>
   </div>
  </div><!-- Popup Container -->
  <div id="popup-container" class="hidden fixed inset-0 z-50 flex items-center justify-center popup-overlay">
   <div id="popup-content" class="w-full max-w-md mx-4"><!-- Popup content will be rendered here -->
   </div>
  </div>
  <script>
    // ============ CONFIG & STATE ============
    const defaultConfig = {
      app_title: 'Polaco',
      app_subtitle: 'Curso interactivo para extranjeros',
      primary_color: '#003893',
      background_color: 'linear-gradient(180deg, #001a4d 0%, #003893 50%, #001a4d 100%)',
      card_background: '#ffffff',
      text_color: '#FCD116',
      accent_color: '#CE1126'
    };
    
    let config = { ...defaultConfig };
    let isAdmin = localStorage.getItem('polaco_admin') === 'true';
    let exerciseLinks = [];
    let expandedLevels = {};
    let currentPopup = null;
    let currentTopic = null;
    let currentLinkId = null;
    let selectedExerciseType = '';
    let selectedLevel = '';
    
    // Exercise type icons mapping
    const exerciseIcons = {
      'Rellenar los espacios': 'âœï¸',
      'Relacionar palabra con imagen': 'ğŸ–¼ï¸',
      'Relacionar palabra con traducciÃ³n': 'ğŸ”„',
      'Elegir la palabra correcta': 'â˜‘ï¸',
      'Tarjetas interactivas': 'ğŸƒ',
      'Agrupar palabras': 'ğŸ“¦',
      'Verdadero o falso': 'âœ…',
      'Completar la frase con una imagen': 'ğŸ–¼ï¸',
      'Juego de memoria (pares)': 'ğŸ§ ',
      'OpciÃ³n mÃºltiple': 'ğŸ”˜',
      'Completar la forma correcta': 'ğŸ“',
      'Elegir la forma correcta': 'âœ”ï¸',
      'Transformaciones': 'ğŸ”€',
      'Relacionar pregunta con respuesta': 'â“',
      'Ordenar palabras para formar una frase': 'ğŸ”¤',
      'Corregir errores': 'ğŸ”',
      'Unir dos partes de la frase': 'ğŸ§©',
      'Completar con preposiciÃ³n o terminaciÃ³n': 'â•',
      'OpciÃ³n Ãºnica': '1ï¸âƒ£',
      'Escribir tu propia respuesta': 'âœï¸',
      'Repetir despuÃ©s del narrador': 'ğŸ—£ï¸',
      'Completar la frase con tu voz': 'ğŸ¤',
      'Responder a una pregunta': 'ğŸ’¬',
      'Describir una imagen': 'ğŸ¨',
      'Juego de roles': 'ğŸ­',
      'Mini-monÃ³logo': 'ğŸ“£',
      'DiÃ¡logo semiabierto': 'ğŸ’­',
      'Decirlo de otra manera': 'ğŸ”',
      'Escuchar y elegir la respuesta': 'ğŸ‘‚',
      'Escuchar y completar los espacios': 'ğŸ§',
      'Escuchar y marcar verdadero o falso': 'ğŸ‘‚',
      'Escuchar y relacionar personas': 'ğŸ‘¥',
      'Escuchar y ordenar la secuencia': 'ğŸ”¢',
      'Dictado con audio': 'ğŸ“»',
      'Escuchar y repetir': 'ğŸ”Š',
      'DiÃ¡logo interactivo': 'ğŸ’¬',
      'MisiÃ³n del dÃ­a': 'ğŸ¯',
      'Quiz situacional': 'ğŸ²',
      'Video con preguntas': 'ğŸ¬'
    };
    
    function getExerciseTypeOptions(selectedValue = '') {
      const types = [
        'Rellenar los espacios',
        'Relacionar palabra con imagen',
        'Relacionar palabra con traducciÃ³n',
        'Elegir la palabra correcta',
        'Tarjetas interactivas',
        'Agrupar palabras',
        'Verdadero o falso',
        'Completar la frase con una imagen',
        'Juego de memoria (pares)',
        'OpciÃ³n mÃºltiple',
        'Completar la forma correcta',
        'Elegir la forma correcta',
        'Transformaciones',
        'Relacionar pregunta con respuesta',
        'Ordenar palabras para formar una frase',
        'Corregir errores',
        'Unir dos partes de la frase',
        'Completar con preposiciÃ³n o terminaciÃ³n',
        'OpciÃ³n Ãºnica',
        'Escribir tu propia respuesta',
        'Repetir despuÃ©s del narrador',
        'Completar la frase con tu voz',
        'Responder a una pregunta',
        'Describir una imagen',
        'Juego de roles',
        'Mini-monÃ³logo',
        'DiÃ¡logo semiabierto',
        'Decirlo de otra manera',
        'Escuchar y elegir la respuesta',
        'Escuchar y completar los espacios',
        'Escuchar y marcar verdadero o falso',
        'Escuchar y relacionar personas',
        'Escuchar y ordenar la secuencia',
        'Dictado con audio',
        'Escuchar y repetir',
        'DiÃ¡logo interactivo',
        'MisiÃ³n del dÃ­a',
        'Quiz situacional',
        'Video con preguntas'
      ];
      
      let options = '<option value="">Seleccionar tipo...</option>';
      types.forEach(type => {
        const icon = exerciseIcons[type] || 'ğŸ“';
        const selected = type === selectedValue ? 'selected' : '';
        options += `<option value="${type}" ${selected}>${icon} ${type}</option>`;
      });
      
      return options;
    }
    
    // ============ COURSE DATA ============
    const courseData = {
      A1: {
        title: 'Nivel A1',
        subtitle: 'Fundamentos de la vida en Polonia',
        description: 'Nivel bÃ¡sico para comenzar tu aventura con el polaco. AprenderÃ¡s las estructuras fundamentales del idioma.',
        gradient: 'linear-gradient(135deg, #10b981, #059669)',
        grammar: [
          { id: 'a1-g1', title: 'Alfabeto y pronunciaciÃ³n', titlePl: 'Alfabet i wymowa', desc: 'Aprender a leer y pronunciar correctamente los sonidos y letras del polaco', category: 'Grammar' },
          { id: 'a1-g2', title: 'Orden de palabras en la frase', titlePl: 'Szyk wyrazÃ³w w zdaniu', desc: 'Aprender a construir frases simples con el orden bÃ¡sico de palabras en polaco', category: 'Grammar' },
          { id: 'a1-g3', title: 'Verbos bÃ¡sicos: byÄ‡ y mieÄ‡', titlePl: 'Czasowniki podstawowe: byÄ‡ i mieÄ‡', desc: 'Aprender a decir quiÃ©n eres, cÃ³mo eres y quÃ© tienes usando los verbos mÃ¡s importantes del polaco', category: 'Grammar' },
          { id: 'a1-g4', title: 'Presente: verbos regulares', titlePl: 'Czas teraÅºniejszy: czasowniki regularne', desc: 'Aprender a conjugar verbos regulares en presente para hablar de rutinas y hechos actuales', category: 'Grammar' },
          { id: 'a1-g5', title: 'Pronombres personales y posesivos', titlePl: 'Zaimki osobowe i dzierÅ¼awcze', desc: 'Aprender a usar yo, tÃº, Ã©l/ella y mi, tu, su en frases sencillas', category: 'Grammar' },
          { id: 'a1-g6', title: 'Oraciones afirmativas, negativas y preguntas', titlePl: 'Zdania twierdzÄ…ce, przeczÄ…ce i pytania', desc: 'Aprender a formar frases, negar informaciÃ³n y hacer preguntas bÃ¡sicas', category: 'Grammar' },
          { id: 'a1-g7', title: 'Sustantivos: gÃ©nero y nÃºmero', titlePl: 'Rzeczowniki: rodzaj i liczba', desc: 'Aprender a reconocer el gÃ©nero de los sustantivos y formar el plural', category: 'Grammar' },
          { id: 'a1-g8', title: 'Adjetivos y concordancia', titlePl: 'Przymiotniki i ich zgodnoÅ›Ä‡', desc: 'Aprender a describir personas y cosas y hacer concordar el adjetivo con el sustantivo', category: 'Grammar' },
          { id: 'a1-g9', title: 'Preposiciones bÃ¡sicas: w, na, do', titlePl: 'Przyimki podstawowe: w, na, do', desc: 'Aprender a hablar de lugar y direcciÃ³n con las preposiciones mÃ¡s usadas', category: 'Grammar' },
          { id: 'a1-g10', title: 'Caso acusativo (introducciÃ³n)', titlePl: 'Biernik (wprowadzenie)', desc: 'Aprender a hablar de lo que ves, compras o comes usando la forma correcta del sustantivo', category: 'Grammar' },
          { id: 'a1-g11', title: 'NÃºmeros y cantidades', titlePl: 'Liczby i iloÅ›ci', desc: 'Aprender a usar nÃºmeros para edad, precios, horas y telÃ©fonos', category: 'Grammar' }
        ],
        vocabulary: [
          { id: 'a1-v1', title: 'Saludos y presentaciÃ³n', titlePl: 'Powitania i przedstawianie siÄ™', desc: 'Aprender a saludar, despedirse, presentarse y decir informaciÃ³n bÃ¡sica sobre uno mismo', category: 'Vocab' },
          { id: 'a1-v2', title: 'PaÃ­ses y nacionalidades', titlePl: 'Kraje i narodowoÅ›ci', desc: 'Aprender a decir de quÃ© paÃ­s eres y cuÃ¡l es tu nacionalidad', category: 'Vocab' },
          { id: 'a1-v3', title: 'InformaciÃ³n personal', titlePl: 'Informacje osobiste', desc: 'Aprender a hablar de la edad, el estado civil y datos bÃ¡sicos sobre uno mismo', category: 'Vocab' },
          { id: 'a1-v4', title: 'Profesiones y trabajo', titlePl: 'Zawody i praca', desc: 'Aprender a decir a quÃ© te dedicas y dÃ³nde trabajas', category: 'Vocab' },
          { id: 'a1-v5', title: 'Familia', titlePl: 'Rodzina', desc: 'Aprender a nombrar a los miembros de la familia y hablar de relaciones familiares simples', category: 'Vocab' },
          { id: 'a1-v6', title: 'Casa y vivienda', titlePl: 'Dom i mieszkanie', desc: 'Aprender a nombrar las habitaciones y los objetos bÃ¡sicos de la casa', category: 'Vocab' },
          { id: 'a1-v7', title: 'Comida y bebidas', titlePl: 'Jedzenie i napoje', desc: 'Aprender a hablar de comida, bebidas y preferencias simples', category: 'Vocab' },
          { id: 'a1-v8', title: 'Tienda y compras', titlePl: 'Sklep i zakupy', desc: 'Aprender a hacer compras simples y preguntar por precios', category: 'Vocab' },
          { id: 'a1-v9', title: 'Ropa', titlePl: 'Ubrania', desc: 'Aprender a nombrar prendas de vestir y decir quÃ© llevas puesto', category: 'Vocab' },
          { id: 'a1-v10', title: 'Tiempo y dÃ­as', titlePl: 'Czas i dni', desc: 'Aprender a hablar de los dÃ­as de la semana y las partes del dÃ­a', category: 'Vocab' },
          { id: 'a1-v11', title: 'Rutina diaria', titlePl: 'Codzienna rutyna', desc: 'Aprender a hablar de actividades cotidianas', category: 'Vocab' },
          { id: 'a1-v12', title: 'Ciudad y lugares', titlePl: 'Miasto i miejsca', desc: 'Aprender a nombrar lugares de la ciudad y decir dÃ³nde estÃ¡s', category: 'Vocab' },
          { id: 'a1-v13', title: 'Direcciones y orientaciÃ³n', titlePl: 'Kierunki i orientacja', desc: 'Aprender a pedir direcciones y entender indicaciones simples', category: 'Vocab' },
          { id: 'a1-v14', title: 'MÃ©dico y salud (bÃ¡sico)', titlePl: 'Lekarz i zdrowie (podstawy)', desc: 'Aprender a decir quÃ© te duele y pedir ayuda mÃ©dica', category: 'Vocab' },
          { id: 'a1-v15', title: 'Oficina pÃºblica y documentos (bÃ¡sico)', titlePl: 'UrzÄ…d i dokumenty (podstawy)', desc: 'Aprender a nombrar documentos y decir para quÃ© vienes a la oficina pÃºblica', category: 'Vocab' },
          { id: 'a1-v16', title: 'Frases Ãºtiles', titlePl: 'Przydatne zwroty', desc: 'Aprender frases de cortesÃ­a y expresiones bÃ¡sicas para la comunicaciÃ³n diaria', category: 'Vocab' }
        ]
      },
      A2: {
        title: 'Nivel A2',
        subtitle: 'Funcionamiento cotidiano',
        description: 'Profundiza tus conocimientos bÃ¡sicos y amplÃ­a tu vocabulario para situaciones cotidianas.',
        gradient: 'linear-gradient(135deg, #003893, #0055CC)',
        grammar: [
          { id: 'a2-g1', title: 'Presente: verbos irregulares', titlePl: 'Czas teraÅºniejszy: czasowniki nieregularne', desc: 'Aprender a conjugar verbos irregulares y hablar con mÃ¡s naturalidad', category: 'Grammar' },
          { id: 'a2-g2', title: 'Verbos reflexivos', titlePl: 'Czasowniki zwrotne', desc: 'Aprender a hablar de rutinas personales como levantarse, vestirse o sentirse', category: 'Grammar' },
          { id: 'a2-g3', title: 'Pasado simple', titlePl: 'Czas przeszÅ‚y prosty', desc: 'Aprender a hablar de acciones pasadas y contar quÃ© hiciste ayer o la semana pasada', category: 'Grammar' },
          { id: 'a2-g4', title: 'Futuro simple', titlePl: 'Czas przyszÅ‚y prosty', desc: 'Aprender a hablar de planes y decisiones futuras', category: 'Grammar' },
          { id: 'a2-g5', title: 'Verbos modales: mÃ³c, musieÄ‡, chcieÄ‡', titlePl: 'Czasowniki modalne: mÃ³c, musieÄ‡, chcieÄ‡', desc: 'Aprender a expresar posibilidad, obligaciÃ³n y deseo', category: 'Grammar' },
          { id: 'a2-g6', title: 'Casos del polaco: visiÃ³n general', titlePl: 'Przypadki w jÄ™zyku polskim: przeglÄ…d', desc: 'Aprender para quÃ© sirven los casos y cuÃ¡ndo cambia la forma de las palabras', category: 'Grammar' },
          { id: 'a2-g7', title: 'Caso genitivo', titlePl: 'DopeÅ‚niacz', desc: 'Aprender a hablar de posesiÃ³n, cantidad y negaciÃ³n', category: 'Grammar' },
          { id: 'a2-g8', title: 'Caso locativo', titlePl: 'Miejscownik', desc: 'Aprender a hablar de lugar despuÃ©s de preposiciones como w y na', category: 'Grammar' },
          { id: 'a2-g9', title: 'Caso instrumental', titlePl: 'NarzÄ™dnik', desc: 'Aprender a hablar de con quiÃ©n y con quÃ© haces algo', category: 'Grammar' },
          { id: 'a2-g10', title: 'Preposiciones con casos', titlePl: 'Przyimki z przypadkami', desc: 'Aprender quÃ© caso usar despuÃ©s de cada preposiciÃ³n', category: 'Grammar' },
          { id: 'a2-g11', title: 'Comparativos y superlativos', titlePl: 'Stopniowanie przymiotnikÃ³w', desc: 'Aprender a comparar personas y cosas', category: 'Grammar' },
          { id: 'a2-g12', title: 'Adverbios de tiempo y frecuencia', titlePl: 'PrzysÅ‚Ã³wki czasu i czÄ™stotliwoÅ›ci', desc: 'Aprender a decir cuÃ¡ndo y con quÃ© frecuencia haces algo', category: 'Grammar' },
          { id: 'a2-g13', title: 'Conectores bÃ¡sicos', titlePl: 'SpÃ³jniki podstawowe', desc: 'Aprender a unir frases con palabras como i, ale, bo, dlatego', category: 'Grammar' }
        ],
        vocabulary: [
          { id: 'a2-v1', title: 'PresentaciÃ³n y small talk', titlePl: 'Przedstawianie siÄ™ i small talk', desc: 'Aprender a mantener una conversaciÃ³n corta y hablar un poco mÃ¡s sobre ti', category: 'Vocab' },
          { id: 'a2-v2', title: 'Trabajo y responsabilidades', titlePl: 'Praca i obowiÄ…zki', desc: 'Aprender a hablar de tu trabajo, horarios y tareas', category: 'Vocab' },
          { id: 'a2-v3', title: 'Vivienda y alquiler', titlePl: 'Mieszkanie i wynajem', desc: 'Aprender a hablar del alquiler, el equipamiento y problemas en el departamento', category: 'Vocab' },
          { id: 'a2-v4', title: 'Comida y restaurante', titlePl: 'Jedzenie i restauracja', desc: 'Aprender a pedir comida y hablar de tus preferencias alimenticias', category: 'Vocab' },
          { id: 'a2-v5', title: 'Tienda y devoluciones', titlePl: 'Sklep i zwroty', desc: 'Aprender a preguntar por productos y resolver problemas simples con compras', category: 'Vocab' },
          { id: 'a2-v6', title: 'MÃ©dico y farmacia', titlePl: 'Lekarz i apteka', desc: 'Aprender a describir sÃ­ntomas y comprar medicamentos', category: 'Vocab' },
          { id: 'a2-v7', title: 'Oficina pÃºblica y trÃ¡mites', titlePl: 'UrzÄ…d i zaÅ‚atwianie spraw', desc: 'Aprender a hacer trÃ¡mites simples en oficinas pÃºblicas', category: 'Vocab' },
          { id: 'a2-v8', title: 'Transporte pÃºblico', titlePl: 'Transport publiczny', desc: 'Aprender a comprar boletos y moverte por la ciudad', category: 'Vocab' },
          { id: 'a2-v9', title: 'Tiempo libre', titlePl: 'Czas wolny', desc: 'Aprender a hablar de hobbies y planes para el fin de semana', category: 'Vocab' },
          { id: 'a2-v10', title: 'Emociones y estado de Ã¡nimo', titlePl: 'Emocje i nastrÃ³j', desc: 'Aprender a decir cÃ³mo te sientes y por quÃ©', category: 'Vocab' }
        ]
      },
      B1: {
        title: 'Nivel B1',
        subtitle: 'Vida independiente en Polonia',
        description: 'Desarrolla tu capacidad de comunicaciÃ³n en situaciones mÃ¡s complejas.',
        gradient: 'linear-gradient(135deg, #FCD116, #FFD700)',
        grammar: [
          { id: 'b1-g1', title: 'Aspecto verbal: perfecto e imperfecto', titlePl: 'Aspekt czasownika: dokonany i niedokonany', desc: 'Aprender a diferenciar acciones terminadas y en proceso', category: 'Grammar' },
          { id: 'b1-g2', title: 'Pasado: narraciÃ³n y secuencia', titlePl: 'Czas przeszÅ‚y: narracja i kolejnoÅ›Ä‡', desc: 'Aprender a contar historias y describir una secuencia de eventos', category: 'Grammar' },
          { id: 'b1-g3', title: 'Futuro compuesto y planes', titlePl: 'Czas przyszÅ‚y zÅ‚oÅ¼ony i plany', desc: 'Aprender a hablar de planes y predicciones con mÃ¡s precisiÃ³n', category: 'Grammar' },
          { id: 'b1-g4', title: 'Imperativo', titlePl: 'Tryb rozkazujÄ…cy', desc: 'Aprender a dar instrucciones, consejos y Ã³rdenes', category: 'Grammar' },
          { id: 'b1-g5', title: 'Caso dativo', titlePl: 'Celownik', desc: 'Aprender a decir a quiÃ©n le das algo y para quiÃ©n haces algo', category: 'Grammar' },
          { id: 'b1-g6', title: 'Caso vocativo', titlePl: 'WoÅ‚acz', desc: 'Aprender a dirigirte correctamente a una persona', category: 'Grammar' },
          { id: 'b1-g7', title: 'Pronombres de objeto', titlePl: 'Zaimki dopeÅ‚nienia', desc: 'Aprender a reemplazar sustantivos por pronombres', category: 'Grammar' },
          { id: 'b1-g8', title: 'Oraciones subordinadas bÃ¡sicas', titlePl: 'Zdania podrzÄ™dne podstawowe', desc: 'Aprender a usar Å¼e, bo, kiedy, jeÅ›li para construir frases mÃ¡s largas', category: 'Grammar' },
          { id: 'b1-g9', title: 'Condicional simple', titlePl: 'Tryb przypuszczajÄ…cy prosty', desc: 'Aprender a hablar de situaciones hipotÃ©ticas simples', category: 'Grammar' },
          { id: 'b1-g10', title: 'Estilo formal e informal', titlePl: 'Styl formalny i nieformalny', desc: 'Aprender a adaptar tu lenguaje a situaciones oficiales y privadas', category: 'Grammar' }
        ],
        vocabulary: [
          { id: 'b1-v1', title: 'Trabajo y carrera profesional', titlePl: 'Praca i kariera zawodowa', desc: 'Aprender a hablar de experiencia laboral, planes profesionales y cambio de trabajo', category: 'Vocab' },
          { id: 'b1-v2', title: 'Salud y mÃ©dico', titlePl: 'Zdrowie i lekarz', desc: 'Aprender a describir mejor los sÃ­ntomas y hablar con el mÃ©dico', category: 'Vocab' },
          { id: 'b1-v3', title: 'Vivienda y contratos', titlePl: 'Mieszkanie i umowy', desc: 'Aprender a hablar de contratos y problemas con el dueÃ±o del departamento', category: 'Vocab' },
          { id: 'b1-v4', title: 'Oficinas y procedimientos', titlePl: 'UrzÄ™dy i procedury', desc: 'Aprender a hacer trÃ¡mites de residencia y asuntos administrativos', category: 'Vocab' },
          { id: 'b1-v5', title: 'Banco y finanzas', titlePl: 'Bank i finanse', desc: 'Aprender a hablar de cuentas bancarias, pagos y facturas', category: 'Vocab' },
          { id: 'b1-v6', title: 'Relaciones y vida personal', titlePl: 'ZwiÄ…zki i Å¼ycie osobiste', desc: 'Aprender a hablar de relaciones, pareja y problemas personales', category: 'Vocab' },
          { id: 'b1-v7', title: 'EducaciÃ³n y cursos', titlePl: 'Edukacja i kursy', desc: 'Aprender a hablar de estudios y desarrollo profesional', category: 'Vocab' },
          { id: 'b1-v8', title: 'Viajes por Polonia', titlePl: 'PodrÃ³Å¼e po Polsce', desc: 'Aprender a planear viajes y reservar alojamiento', category: 'Vocab' },
          { id: 'b1-v9', title: 'Medios y tecnologÃ­a', titlePl: 'Media i tecnologia', desc: 'Aprender a hablar de telÃ©fono, internet y aplicaciones', category: 'Vocab' }
        ]
      },
      B2: {
        title: 'Nivel B2',
        subtitle: 'IntegraciÃ³n total',
        description: 'Perfecciona tu polaco para alcanzar un nivel avanzado de comunicaciÃ³n.',
        gradient: 'linear-gradient(135deg, #CE1126, #FF1E3C)',
        grammar: [
          { id: 'b2-g1', title: 'Aspecto verbal avanzado', titlePl: 'Aspekt czasownika zaawansowany', desc: 'Aprender a elegir correctamente el aspecto segÃºn la intenciÃ³n comunicativa', category: 'Grammar' },
          { id: 'b2-g2', title: 'Voz pasiva', titlePl: 'Strona bierna', desc: 'Aprender a enfocar la acciÃ³n y no la persona que la realiza', category: 'Grammar' },
          { id: 'b2-g3', title: 'Participios y gerundios', titlePl: 'ImiesÅ‚owy i gerundium', desc: 'Aprender a construir frases mÃ¡s naturales y compactas', category: 'Grammar' },
          { id: 'b2-g4', title: 'Oraciones subordinadas complejas', titlePl: 'Zdania podrzÄ™dne zÅ‚oÅ¼one', desc: 'Aprender a usar estructuras con ktÃ³ry, Å¼eby, chociaÅ¼, poniewaÅ¼', category: 'Grammar' },
          { id: 'b2-g5', title: 'Estilo indirecto', titlePl: 'Mowa zaleÅ¼na', desc: 'Aprender a contar lo que alguien dijo', category: 'Grammar' },
          { id: 'b2-g6', title: 'Condicional avanzado', titlePl: 'Tryb przypuszczajÄ…cy zaawansowany', desc: 'Aprender a hablar de situaciones irreales y del pasado', category: 'Grammar' },
          { id: 'b2-g7', title: 'Orden de palabras avanzado', titlePl: 'Szyk wyrazÃ³w zaawansowany', desc: 'Aprender a enfatizar informaciÃ³n cambiando el orden de la frase', category: 'Grammar' },
          { id: 'b2-g8', title: 'Registro y estilo', titlePl: 'Rejestr i styl', desc: 'Aprender a sonar natural, educado o formal segÃºn la situaciÃ³n', category: 'Grammar' },
          { id: 'b2-g9', title: 'Colocaciones y estructuras fijas', titlePl: 'Kolokacje i struktury ustalone', desc: 'Aprender a usar combinaciones de palabras tÃ­picas del polaco', category: 'Grammar' }
        ],
        vocabulary: [
          { id: 'b2-v1', title: 'Trabajo y mercado laboral', titlePl: 'Praca i rynek pracy', desc: 'Aprender a debatir sobre trabajo, condiciones laborales y desarrollo profesional', category: 'Vocab' },
          { id: 'b2-v2', title: 'Salud y estilo de vida', titlePl: 'Zdrowie i styl Å¼ycia', desc: 'Aprender a hablar de la salud fÃ­sica y mental', category: 'Vocab' },
          { id: 'b2-v3', title: 'Sociedad en Polonia', titlePl: 'SpoÅ‚eczeÅ„stwo w Polsce', desc: 'Aprender a conversar sobre la vida en Polonia y las diferencias culturales', category: 'Vocab' },
          { id: 'b2-v4', title: 'Derecho y derechos del extranjero', titlePl: 'Prawo i prawa cudzoziemca', desc: 'Aprender a hablar de derechos, deberes y trÃ¡mites legales', category: 'Vocab' },
          { id: 'b2-v5', title: 'Relaciones y conflictos', titlePl: 'ZwiÄ…zki i konflikty', desc: 'Aprender a resolver conflictos y expresar emociones con claridad', category: 'Vocab' },
          { id: 'b2-v6', title: 'Medios y opiniones', titlePl: 'Media i opinie', desc: 'Aprender a expresar opiniones y comentar acontecimientos', category: 'Vocab' },
          { id: 'b2-v7', title: 'Valores y creencias', titlePl: 'WartoÅ›ci i przekonania', desc: 'Aprender a hablar de valores personales y puntos de vista', category: 'Vocab' },
          { id: 'b2-v8', title: 'ArgumentaciÃ³n y debate', titlePl: 'Argumentacja i debata', desc: 'Aprender a debatir y defender tu opiniÃ³n', category: 'Vocab' }
        ]
      }
    };
    
    // ============ HELPER FUNCTIONS ============
    function getTopicLock(topicId) {
      const lock = exerciseLinks.find(l => l.is_topic_lock && l.topic_id === topicId);
      return lock;
    }
    
    function isTopicLocked(topicId) {
      return !!getTopicLock(topicId);
    }
    
    function applyFilters() {
      selectedExerciseType = document.getElementById('exercise-type-filter').value;
      selectedLevel = document.getElementById('level-filter').value;
      renderLevelCards();
      updateFilterCount();
    }
    
    function updateFilterCount() {
      const counter = document.getElementById('filter-count');
      
      if (!selectedExerciseType && !selectedLevel) {
        counter.textContent = '';
        return;
      }
      
      let totalMatches = 0;
      
      Object.entries(courseData).forEach(([level, data]) => {
        if (selectedLevel && selectedLevel !== level) return;
        
        [...data.grammar, ...data.vocabulary].forEach(topic => {
          const topicLinks = exerciseLinks.filter(link => 
            link.topic_id === topic.id && 
            !link.is_topic_lock &&
            (!selectedExerciseType || link.exercise_type === selectedExerciseType)
          );
          totalMatches += topicLinks.length;
        });
      });
      
      counter.textContent = `${totalMatches} ejercicio${totalMatches !== 1 ? 's' : ''} encontrado${totalMatches !== 1 ? 's' : ''}`;
    }
    
    function topicHasMatchingExercises(topicId) {
      const topicLinks = exerciseLinks.filter(link => 
        link.topic_id === topicId && 
        !link.is_topic_lock &&
        (!selectedExerciseType || link.exercise_type === selectedExerciseType)
      );
      return topicLinks.length > 0;
    }
    
    // ============ RENDER FUNCTIONS ============
    function renderLevelCards() {
      const container = document.getElementById('levels-container');
      const searchTerm = document.getElementById('search-input').value.toLowerCase();
      
      let html = '';
      
      for (const [level, data] of Object.entries(courseData)) {
        // Skip level if level filter is active and doesn't match
        if (selectedLevel && selectedLevel !== level) continue;
        
        const isExpanded = expandedLevels[level] || false;
        
        // Filter topics by search and exercise type
        const filteredGrammar = data.grammar.filter(t => {
          const matchesSearch = searchTerm === '' || t.title.toLowerCase().includes(searchTerm) || t.desc.toLowerCase().includes(searchTerm);
          const hasExercises = !selectedExerciseType || topicHasMatchingExercises(t.id);
          return matchesSearch && hasExercises;
        });
        
        const filteredVocab = data.vocabulary.filter(t => {
          const matchesSearch = searchTerm === '' || t.title.toLowerCase().includes(searchTerm) || t.desc.toLowerCase().includes(searchTerm);
          const hasExercises = !selectedExerciseType || topicHasMatchingExercises(t.id);
          return matchesSearch && hasExercises;
        });
        
        const hasResults = filteredGrammar.length > 0 || filteredVocab.length > 0;
        
        if (!hasResults) continue;
        
        html += `
          <div class="level-card card">
            <div 
              class="flex items-center justify-between p-5 cursor-pointer"
              onclick="toggleLevel('${level}')"
            >
              <div class="flex items-center gap-4">
                <div 
                  class="w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg"
                  style="background: ${data.gradient};"
                >
                  ${level}
                </div>
                <div>
                  <h3 class="font-bold text-lg" style="color: var(--blue-main);">${data.title}</h3>
                  <p class="text-sm" style="color: var(--gray-text);">${data.subtitle}</p>
                </div>
              </div>
              <svg 
                class="w-5 h-5 accordion-arrow ${isExpanded ? 'open' : ''}" 
                style="color: var(--yellow-main);"
                fill="none" 
                stroke="currentColor" 
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </div>
            
            ${isExpanded ? `
              <div class="px-5 pb-5">
                <p class="text-sm mb-6" style="color: var(--gray-text);">${data.description}</p>
                
                ${filteredGrammar.length > 0 ? `
                  <div class="mb-6">
                    <h4 class="font-bold mb-3 flex items-center gap-2" style="color: var(--blue-main);">
                      ğŸ“˜ GramÃ¡tica
                    </h4>
                    <div class="space-y-3">
                      ${filteredGrammar.map(topic => renderTopicTile(topic, level, 'grammar')).join('')}
                    </div>
                  </div>
                ` : ''}
                
                ${filteredVocab.length > 0 ? `
                  <div>
                    <h4 class="font-bold mb-3 flex items-center gap-2" style="color: var(--blue-main);">
                      ğŸ“— Vocabulario
                    </h4>
                    <div class="space-y-3">
                      ${filteredVocab.map(topic => renderTopicTile(topic, level, 'vocabulary')).join('')}
                    </div>
                  </div>
                ` : ''}
              </div>
            ` : ''}
          </div>
        `;
      }
      
      container.innerHTML = html;
    }
    
    function renderTopicTile(topic, level, type) {
      const borderColor = type === 'grammar' ? 'var(--blue-main)' : 'var(--red-main)';
      const locked = isTopicLocked(topic.id);
      
      return `
        <div 
          class="topic-tile card cursor-pointer flex items-center"
          onclick="${locked && !isAdmin ? `openTopicPasswordPopup('${topic.id}', '${topic.title}', '${level}', '${type}')` : `openExercisesPopup('${topic.id}', '${topic.title}', '${level}', '${type}')`}"
        >
          <div class="w-1 h-12 rounded-full mr-4" style="background-color: ${borderColor};"></div>
          <div class="flex-1">
            <h5 class="font-semibold flex items-center gap-2" style="color: var(--blue-main);">
              ${locked ? 'ğŸ”’ ' : ''}${topic.title}
            </h5>
            ${topic.titlePl ? `<p class="text-xs mb-1" style="color: var(--yellow-main);">${topic.titlePl}</p>` : ''}
            <p class="text-sm" style="color: var(--gray-text);">${topic.desc}</p>
          </div>
          <svg class="w-5 h-5" style="color: var(--yellow-main);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </div>
      `;
    }
    
    function toggleLevel(level) {
      expandedLevels[level] = !expandedLevels[level];
      renderLevelCards();
    }
    
    // ============ POPUP FUNCTIONS ============
    function showPopup(content) {
      const container = document.getElementById('popup-container');
      const contentDiv = document.getElementById('popup-content');
      contentDiv.innerHTML = content;
      container.classList.remove('hidden');
    }
    
    function hidePopup() {
      const container = document.getElementById('popup-container');
      container.classList.add('hidden');
      currentPopup = null;
      currentTopic = null;
      currentLinkId = null;
    }
    
    function getPopupFooter() {
      return `
        <div class="border-t pt-4 mt-4 flex items-center justify-between" style="border-color: rgba(252, 209, 22, 0.3);">
          <a 
            href="https://instagram.com/sacariooo" 
            target="_blank" 
            rel="noopener noreferrer"
            class="flex items-center gap-2 text-xs hover:opacity-80 transition-opacity"
            style="color: #94a3b8;"
          >
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
            </svg>
            @sacariooo
          </a>
          <a 
            href="https://tiktok.com/@latip0l" 
            target="_blank" 
            rel="noopener noreferrer"
            class="flex items-center gap-2 text-xs hover:opacity-80 transition-opacity"
            style="color: #94a3b8;"
          >
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
            </svg>
            @latip0l
          </a>
        </div>
      `;
    }
    
    function openTopicPasswordPopup(topicId, topicTitle, level, type) {
      currentTopic = { id: topicId, title: topicTitle, level, type };
      currentPopup = 'topicPassword';
      
      const content = `
        <div class="card" style="height: 380px; display: flex; flex-direction: column;">
          <div class="text-center mb-6">
            <div class="w-14 h-14 mx-auto mb-3 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, var(--yellow-main), var(--yellow-light));">
              <svg class="w-7 h-7" style="color: var(--blue-main);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
              </svg>
            </div>
            <h2 class="font-display text-xl font-bold" style="color: var(--blue-main);">Tema protegido</h2>
            <p class="text-sm" style="color: var(--gray-text);">${topicTitle}</p>
          </div>
          
          <div class="flex-1">
            <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">ContraseÃ±a</label>
            <input 
              type="password" 
              id="topic-password-input"
              class="w-full py-3 px-4 rounded-xl border-2 text-base"
              style="border-color: var(--yellow-main); color: var(--blue-main);"
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
            >
            <p id="topic-password-error" class="text-sm mt-2 hidden" style="color: var(--red-main);">ContraseÃ±a incorrecta</p>
          </div>
          
          <div class="flex gap-3 mt-4">
            <button 
              onclick="hidePopup()"
              class="flex-1 py-3 rounded-xl font-semibold transition-opacity hover:opacity-80"
              style="background-color: #e5e7eb; color: #6b7280;"
            >
              Cancelar
            </button>
            <button 
              onclick="checkTopicPassword()"
              class="btn-yellow flex-1"
            >
              Abrir
            </button>
          </div>
          
          ${getPopupFooter()}
        </div>
      `;
      
      showPopup(content);
    }
    
    function checkTopicPassword() {
      const input = document.getElementById('topic-password-input');
      const error = document.getElementById('topic-password-error');
      const lock = getTopicLock(currentTopic.id);
      
      if (!lock) return;
      
      if (input.value === lock.topic_password) {
        openExercisesPopup(currentTopic.id, currentTopic.title, currentTopic.level, currentTopic.type);
      } else {
        error.classList.remove('hidden');
        input.value = '';
      }
    }
    
    function openExercisesPopup(topicId, topicTitle, level, type) {
      currentTopic = { id: topicId, title: topicTitle, level, type };
      currentPopup = 'exercises';
      
      const topicLinks = exerciseLinks.filter(link => link.topic_id === topicId && !link.is_topic_lock);
      const typeLabel = type === 'grammar' ? 'GramÃ¡tica' : 'Vocabulario';
      const locked = isTopicLocked(topicId);
      
      let linksHtml = '';
      if (topicLinks.length === 0) {
        linksHtml = `
          <p class="text-center py-4" style="color: var(--gray-text);">No hay links guardados aÃºn.</p>
        `;
      } else {
        linksHtml = topicLinks.map(link => {
          const icon = exerciseIcons[link.exercise_type] || 'ğŸ“';
          return `
            <div class="mb-3">
              ${link.password ? `
                <div 
                  onclick="openPasswordLinkPopup('${link.__backendId}')"
                  class="block p-3 rounded-xl hover:opacity-80 transition-opacity cursor-pointer"
                  style="background: linear-gradient(135deg, rgba(252, 209, 22, 0.1), rgba(255, 215, 0, 0.1));"
                >
                  <div class="font-medium flex items-center gap-2" style="color: var(--blue-main);">
                    ${icon} ğŸ”’ ${link.description}
                  </div>
                  ${link.notes ? `<div class="text-xs mt-1" style="color: var(--gray-text);">${link.notes}</div>` : ''}
                </div>
              ` : `
                <a 
                  href="${link.url}" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  class="block p-3 rounded-xl hover:opacity-80 transition-opacity"
                  style="background: linear-gradient(135deg, rgba(252, 209, 22, 0.1), rgba(255, 215, 0, 0.1));"
                >
                  <div class="font-medium flex items-center gap-2" style="color: var(--blue-main);">
                    ${icon} ${link.description}
                  </div>
                  ${link.notes ? `<div class="text-xs mt-1" style="color: var(--gray-text);">${link.notes}</div>` : ''}
                </a>
              `}
              ${isAdmin ? `
                <div class="flex gap-3 mt-2 px-3">
                  <button 
                    onclick="openEditLinkPopup('${link.__backendId}')"
                    class="admin-link"
                    style="color: var(--blue-main);"
                  >
                    âœï¸ Editar
                  </button>
                  <button 
                    onclick="deleteLink('${link.__backendId}')"
                    class="admin-link"
                    style="color: var(--red-main);"
                  >
                    Ã— Eliminar
                  </button>
                </div>
              ` : ''}
            </div>
          `;
        }).join('');
      }
      
      const content = `
        <div class="card" style="height: 420px; display: flex; flex-direction: column;">
          <div class="text-center mb-4">
            <div class="w-14 h-14 mx-auto mb-3 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, var(--blue-main), var(--blue-light));">
              <svg class="w-7 h-7" style="color: white;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
            </div>
            <h2 class="font-display text-xl font-bold" style="color: var(--blue-main);">Ejercicios</h2>
            <p class="text-sm" style="color: var(--gray-text);">${topicTitle}</p>
            <p class="text-xs mt-1" style="color: var(--yellow-main);">Nivel: ${level} | Tipo: ${typeLabel}</p>
          </div>
          
          <div class="flex-1 rounded-2xl p-4 overflow-hidden" style="background: linear-gradient(135deg, rgba(252, 209, 22, 0.05), rgba(255, 215, 0, 0.05));">
            <div class="h-full overflow-y-auto">
              ${linksHtml}
            </div>
          </div>
          
          ${isAdmin ? `
            <div class="flex items-center justify-center gap-4 mt-3">
              <button 
                onclick="openAddLinkPopup()"
                class="admin-link"
                style="color: var(--blue-main);"
              >
                + AÃ±adir link
              </button>
              ${locked ? `
                <button 
                  onclick="unlockTopic('${topicId}')"
                  class="admin-link"
                  style="color: var(--red-main);"
                >
                  ğŸ”“ Desbloquear tema
                </button>
              ` : `
                <button 
                  onclick="openLockTopicPopup()"
                  class="admin-link"
                  style="color: var(--yellow-main);"
                >
                  ğŸ”’ Bloquear tema
                </button>
              `}
            </div>
          ` : ''}
          
          <button 
            onclick="hidePopup()"
            class="w-full py-3 rounded-xl font-semibold mt-4 transition-opacity hover:opacity-80"
            style="background-color: #e5e7eb; color: #6b7280;"
          >
            Cerrar
          </button>
          
          ${getPopupFooter()}
        </div>
      `;
      
      showPopup(content);
    }
    
    function openLockTopicPopup() {
      currentPopup = 'lockTopic';
      
      const content = `
        <div class="card" style="height: 380px; display: flex; flex-direction: column;">
          <div class="text-center mb-6">
            <div class="w-14 h-14 mx-auto mb-3 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, var(--yellow-main), var(--yellow-light));">
              <svg class="w-7 h-7" style="color: var(--blue-main);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
              </svg>
            </div>
            <h2 class="font-display text-xl font-bold" style="color: var(--blue-main);">Bloquear tema</h2>
            <p class="text-sm" style="color: var(--gray-text);">${currentTopic?.title || ''}</p>
          </div>
          
          <div class="flex-1">
            <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">ContraseÃ±a para desbloquear</label>
            <input 
              type="text" 
              id="lock-topic-password"
              class="w-full py-3 px-4 rounded-xl border-2 text-base"
              style="border-color: var(--yellow-main); color: var(--blue-main);"
              placeholder="Escribe una contraseÃ±a"
            >
            <p class="text-xs mt-2" style="color: var(--gray-text);">Los estudiantes necesitarÃ¡n esta contraseÃ±a para ver el tema</p>
          </div>
          
          <div class="flex gap-3 mt-4">
            <button 
              onclick="openExercisesPopup('${currentTopic?.id}', '${currentTopic?.title}', '${currentTopic?.level}', '${currentTopic?.type}')"
              class="flex-1 py-3 rounded-xl font-semibold transition-opacity hover:opacity-80"
              style="background-color: #e5e7eb; color: #6b7280;"
            >
              Cancelar
            </button>
            <button 
              onclick="lockTopic()"
              id="lock-topic-btn"
              class="btn-yellow flex-1"
            >
              Bloquear
            </button>
          </div>
          
          ${getPopupFooter()}
        </div>
      `;
      
      showPopup(content);
    }
    
    async function lockTopic() {
      const password = document.getElementById('lock-topic-password').value.trim();
      
      if (!password) return;
      
      if (exerciseLinks.length >= 999) {
        const btn = document.getElementById('lock-topic-btn');
        btn.textContent = 'LÃ­mite alcanzado';
        btn.style.background = 'linear-gradient(135deg, var(--red-main), var(--red-dark))';
        return;
      }
      
      const btn = document.getElementById('lock-topic-btn');
      btn.textContent = 'Bloqueando...';
      btn.disabled = true;
      
      const result = await window.dataSdk.create({
        topic_id: currentTopic.id,
        description: '',
        url: '',
        notes: '',
        password: '',
        topic_password: password,
        is_topic_lock: true,
        created_at: new Date().toISOString()
      });
      
      if (result.isOk) {
        renderLevelCards();
        openExercisesPopup(currentTopic.id, currentTopic.title, currentTopic.level, currentTopic.type);
      } else {
        btn.textContent = 'Error';
        btn.style.background = 'linear-gradient(135deg, var(--red-main), var(--red-dark))';
        setTimeout(() => {
          btn.textContent = 'Bloquear';
          btn.style.background = 'linear-gradient(135deg, var(--yellow-main), var(--yellow-light))';
          btn.disabled = false;
        }, 2000);
      }
    }
    
    async function unlockTopic(topicId) {
      const lock = getTopicLock(topicId);
      if (!lock) return;
      
      const result = await window.dataSdk.delete(lock);
      
      if (result.isOk) {
        renderLevelCards();
        openExercisesPopup(currentTopic.id, currentTopic.title, currentTopic.level, currentTopic.type);
      }
    }
    
    function openPasswordLinkPopup(linkId) {
      currentLinkId = linkId;
      currentPopup = 'passwordLink';
      
      const content = `
        <div class="card" style="height: 380px; display: flex; flex-direction: column;">
          <div class="text-center mb-6">
            <div class="w-14 h-14 mx-auto mb-3 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, var(--yellow-main), var(--yellow-light));">
              <svg class="w-7 h-7" style="color: var(--blue-main);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
              </svg>
            </div>
            <h2 class="font-display text-xl font-bold" style="color: var(--blue-main);">Link protegido</h2>
            <p class="text-sm" style="color: var(--gray-text);">Introduce la contraseÃ±a para acceder</p>
          </div>
          
          <div class="flex-1">
            <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">ContraseÃ±a</label>
            <input 
              type="password" 
              id="link-password-input"
              class="w-full py-3 px-4 rounded-xl border-2 text-base"
              style="border-color: var(--yellow-main); color: var(--blue-main);"
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
            >
            <p id="link-password-error" class="text-sm mt-2 hidden" style="color: var(--red-main);">ContraseÃ±a incorrecta</p>
          </div>
          
          <div class="flex gap-3 mt-4">
            <button 
              onclick="openExercisesPopup('${currentTopic.id}', '${currentTopic.title}', '${currentTopic.level}', '${currentTopic.type}')"
              class="flex-1 py-3 rounded-xl font-semibold transition-opacity hover:opacity-80"
              style="background-color: #e5e7eb; color: #6b7280;"
            >
              Cancelar
            </button>
            <button 
              onclick="checkLinkPassword()"
              class="btn-yellow flex-1"
            >
              Abrir
            </button>
          </div>
          
          ${getPopupFooter()}
        </div>
      `;
      
      showPopup(content);
    }
    
    function checkLinkPassword() {
      const input = document.getElementById('link-password-input');
      const error = document.getElementById('link-password-error');
      const link = exerciseLinks.find(l => l.__backendId === currentLinkId);
      
      if (!link) return;
      
      if (input.value === link.password) {
        window.open(link.url, '_blank', 'noopener,noreferrer');
        hidePopup();
      } else {
        error.classList.remove('hidden');
        input.value = '';
      }
    }
    
    function openPasswordPopup() {
      currentPopup = 'password';
      
      const content = `
        <div class="card" style="height: 380px; display: flex; flex-direction: column;">
          <div class="text-center mb-6">
            <div class="w-14 h-14 mx-auto mb-3 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, var(--yellow-main), var(--yellow-light));">
              <svg class="w-7 h-7" style="color: var(--blue-main);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
              </svg>
            </div>
            <h2 class="font-display text-xl font-bold" style="color: var(--blue-main);">ContraseÃ±a requerida</h2>
          </div>
          
          <div class="flex-1">
            <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">Introduce contraseÃ±a</label>
            <input 
              type="password" 
              id="admin-password"
              class="w-full py-3 px-4 rounded-xl border-2 text-base"
              style="border-color: var(--yellow-main); color: var(--blue-main);"
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
            >
            <p id="password-error" class="text-sm mt-2 hidden" style="color: var(--red-main);">ContraseÃ±a incorrecta</p>
          </div>
          
          <div class="flex gap-3 mt-4">
            <button 
              onclick="hidePopup()"
              class="flex-1 py-3 rounded-xl font-semibold transition-opacity hover:opacity-80"
              style="background-color: #e5e7eb; color: #6b7280;"
            >
              Cancelar
            </button>
            <button 
              onclick="checkPassword()"
              class="btn-yellow flex-1"
            >
              Confirmar
            </button>
          </div>
          
          ${getPopupFooter()}
        </div>
      `;
      
      showPopup(content);
    }
    
    function openAddLinkPopup() {
      currentPopup = 'addLink';
      
      const content = `
        <div class="card" style="max-height: 90vh; display: flex; flex-direction: column;">
          <div class="text-center mb-4">
            <div class="w-14 h-14 mx-auto mb-3 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, var(--yellow-main), var(--yellow-light));">
              <svg class="w-7 h-7" style="color: var(--blue-main);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
              </svg>
            </div>
            <h2 class="font-display text-xl font-bold" style="color: var(--blue-main);">AÃ±adir nuevo link</h2>
            <p class="text-sm" style="color: var(--gray-text);">${currentTopic?.title || ''}</p>
          </div>
          
          <div class="flex-1 space-y-4 overflow-y-auto">
            <div>
              <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">Tipo de ejercicio</label>
              <select 
                id="link-exercise-type"
                class="w-full py-3 px-4 rounded-xl border-2 text-base"
                style="border-color: var(--yellow-main); color: var(--blue-main);"
              >
                ${getExerciseTypeOptions()}
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">DescripciÃ³n del ejercicio</label>
              <input 
                type="text" 
                id="link-description"
                class="w-full py-3 px-4 rounded-xl border-2 text-base"
                style="border-color: var(--yellow-main); color: var(--blue-main);"
                placeholder="Ej: Ejercicios de conjugaciÃ³n"
              >
            </div>
            <div>
              <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">URL del ejercicio</label>
              <input 
                type="url" 
                id="link-url"
                class="w-full py-3 px-4 rounded-xl border-2 text-base"
                style="border-color: var(--yellow-main); color: var(--blue-main);"
                placeholder="https://..."
              >
            </div>
            <div>
              <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">Notas (opcional)</label>
              <input 
                type="text" 
                id="link-notes"
                class="w-full py-3 px-4 rounded-xl border-2 text-base"
                style="border-color: var(--yellow-main); color: var(--blue-main);"
                placeholder="Notas adicionales..."
              >
            </div>
            <div>
              <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">ğŸ”’ Proteger con contraseÃ±a (opcional)</label>
              <input 
                type="text" 
                id="link-password"
                class="w-full py-3 px-4 rounded-xl border-2 text-base"
                style="border-color: var(--yellow-main); color: var(--blue-main);"
                placeholder="Dejar vacÃ­o si no quieres protegerlo"
              >
            </div>
          </div>
          
          <div class="flex gap-3 mt-4">
            <button 
              onclick="openExercisesPopup('${currentTopic?.id}', '${currentTopic?.title}', '${currentTopic?.level}', '${currentTopic?.type}')"
              class="flex-1 py-3 rounded-xl font-semibold transition-opacity hover:opacity-80"
              style="background-color: #e5e7eb; color: #6b7280;"
            >
              Cancelar
            </button>
            <button 
              onclick="saveNewLink()"
              id="save-link-btn"
              class="btn-yellow flex-1"
            >
              Guardar
            </button>
          </div>
          
          ${getPopupFooter()}
        </div>
      `;
      
      showPopup(content);
    }
    
    function openEditLinkPopup(backendId) {
      const linkToEdit = exerciseLinks.find(l => l.__backendId === backendId);
      if (!linkToEdit) return;
      
      currentPopup = 'editLink';
      
      const content = `
        <div class="card" style="max-height: 90vh; display: flex; flex-direction: column;">
          <div class="text-center mb-4">
            <div class="w-14 h-14 mx-auto mb-3 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, var(--blue-main), var(--blue-light));">
              <svg class="w-7 h-7" style="color: white;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
            </div>
            <h2 class="font-display text-xl font-bold" style="color: var(--blue-main);">Editar link</h2>
            <p class="text-sm" style="color: var(--gray-text);">${currentTopic?.title || ''}</p>
          </div>
          
          <div class="flex-1 space-y-4 overflow-y-auto">
            <div>
              <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">Tipo de ejercicio</label>
              <select 
                id="edit-link-exercise-type"
                class="w-full py-3 px-4 rounded-xl border-2 text-base"
                style="border-color: var(--yellow-main); color: var(--blue-main);"
              >
                ${getExerciseTypeOptions(linkToEdit.exercise_type)}
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">DescripciÃ³n del ejercicio</label>
              <input 
                type="text" 
                id="edit-link-description"
                class="w-full py-3 px-4 rounded-xl border-2 text-base"
                style="border-color: var(--yellow-main); color: var(--blue-main);"
                placeholder="Ej: Ejercicios de conjugaciÃ³n"
                value="${linkToEdit.description}"
              >
            </div>
            <div>
              <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">URL del ejercicio</label>
              <input 
                type="url" 
                id="edit-link-url"
                class="w-full py-3 px-4 rounded-xl border-2 text-base"
                style="border-color: var(--yellow-main); color: var(--blue-main);"
                placeholder="https://..."
                value="${linkToEdit.url}"
              >
            </div>
            <div>
              <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">Notas (opcional)</label>
              <input 
                type="text" 
                id="edit-link-notes"
                class="w-full py-3 px-4 rounded-xl border-2 text-base"
                style="border-color: var(--yellow-main); color: var(--blue-main);"
                placeholder="Notas adicionales..."
                value="${linkToEdit.notes || ''}"
              >
            </div>
            <div>
              <label class="block text-sm font-medium mb-2" style="color: var(--blue-main);">ğŸ”’ Proteger con contraseÃ±a (opcional)</label>
              <input 
                type="text" 
                id="edit-link-password"
                class="w-full py-3 px-4 rounded-xl border-2 text-base"
                style="border-color: var(--yellow-main); color: var(--blue-main);"
                placeholder="Dejar vacÃ­o para quitar protecciÃ³n"
                value="${linkToEdit.password || ''}"
              >
            </div>
          </div>
          
          <div class="flex gap-3 mt-4">
            <button 
              onclick="openExercisesPopup('${currentTopic?.id}', '${currentTopic?.title}', '${currentTopic?.level}', '${currentTopic?.type}')"
              class="flex-1 py-3 rounded-xl font-semibold transition-opacity hover:opacity-80"
              style="background-color: #e5e7eb; color: #6b7280;"
            >
              Cancelar
            </button>
            <button 
              onclick="saveEditedLink('${backendId}')"
              id="save-edit-btn"
              class="btn-blue flex-1"
            >
              Actualizar
            </button>
          </div>
          
          ${getPopupFooter()}
        </div>
      `;
      
      showPopup(content);
    }
    
    function checkPassword() {
      const input = document.getElementById('admin-password');
      const error = document.getElementById('password-error');
      
      if (input.value === 'ADMIN123') {
        isAdmin = true;
        localStorage.setItem('polaco_admin', 'true');
        hidePopup();
        updateAdminButton();
      } else {
        error.classList.remove('hidden');
        input.value = '';
      }
    }
    
    async function saveNewLink() {
      const exerciseType = document.getElementById('link-exercise-type').value.trim();
      const description = document.getElementById('link-description').value.trim();
      const url = document.getElementById('link-url').value.trim();
      const notes = document.getElementById('link-notes').value.trim();
      const password = document.getElementById('link-password').value.trim();
      
      if (!exerciseType || !description || !url) return;
      
      if (exerciseLinks.length >= 999) {
        const btn = document.getElementById('save-link-btn');
        btn.textContent = 'LÃ­mite alcanzado';
        btn.style.background = 'linear-gradient(135deg, var(--red-main), var(--red-dark))';
        return;
      }
      
      const btn = document.getElementById('save-link-btn');
      btn.textContent = 'Guardando...';
      btn.disabled = true;
      
      const result = await window.dataSdk.create({
        topic_id: currentTopic.id,
        exercise_type: exerciseType,
        description: description,
        url: url,
        notes: notes,
        password: password || '',
        topic_password: '',
        is_topic_lock: false,
        created_at: new Date().toISOString()
      });
      
      if (result.isOk) {
        openExercisesPopup(currentTopic.id, currentTopic.title, currentTopic.level, currentTopic.type);
      } else {
        btn.textContent = 'Error';
        btn.style.background = 'linear-gradient(135deg, var(--red-main), var(--red-dark))';
        setTimeout(() => {
          btn.textContent = 'Guardar';
          btn.style.background = 'linear-gradient(135deg, var(--yellow-main), var(--yellow-light))';
          btn.disabled = false;
        }, 2000);
      }
    }
    
    async function deleteLink(backendId) {
      const linkToDelete = exerciseLinks.find(l => l.__backendId === backendId);
      if (!linkToDelete) return;
      
      const result = await window.dataSdk.delete(linkToDelete);
      
      if (result.isOk) {
        openExercisesPopup(currentTopic.id, currentTopic.title, currentTopic.level, currentTopic.type);
      }
    }
    
    async function saveEditedLink(backendId) {
      const exerciseType = document.getElementById('edit-link-exercise-type').value.trim();
      const description = document.getElementById('edit-link-description').value.trim();
      const url = document.getElementById('edit-link-url').value.trim();
      const notes = document.getElementById('edit-link-notes').value.trim();
      const password = document.getElementById('edit-link-password').value.trim();
      
      if (!exerciseType || !description || !url) return;
      
      const linkToEdit = exerciseLinks.find(l => l.__backendId === backendId);
      if (!linkToEdit) return;
      
      const btn = document.getElementById('save-edit-btn');
      btn.textContent = 'Actualizando...';
      btn.disabled = true;
      
      const updatedLink = {
        ...linkToEdit,
        exercise_type: exerciseType,
        description: description,
        url: url,
        notes: notes,
        password: password || ''
      };
      
      const result = await window.dataSdk.update(updatedLink);
      
      if (result.isOk) {
        openExercisesPopup(currentTopic.id, currentTopic.title, currentTopic.level, currentTopic.type);
      } else {
        btn.textContent = 'Error';
        btn.style.background = 'linear-gradient(135deg, var(--red-main), var(--red-dark))';
        setTimeout(() => {
          btn.textContent = 'Actualizar';
          btn.style.background = 'linear-gradient(135deg, var(--blue-main), var(--blue-light))';
          btn.disabled = false;
        }, 2000);
      }
    }
    
    function updateAdminButton() {
      const btn = document.getElementById('admin-btn');
      if (isAdmin) {
        btn.textContent = 'âœ… Admin Activo';
        btn.style.opacity = '1';
        btn.onclick = () => {
          isAdmin = false;
          localStorage.removeItem('polaco_admin');
          updateAdminButton();
          renderLevelCards();
        };
      } else {
        btn.textContent = 'ğŸ” Modo Admin';
        btn.style.opacity = '0.6';
        btn.onclick = openPasswordPopup;
      }
    }
    
    // ============ SDK INITIALIZATION ============
    const dataHandler = {
      onDataChanged(data) {
        exerciseLinks = data;
        if (currentPopup === 'exercises' && currentTopic) {
          openExercisesPopup(currentTopic.id, currentTopic.title, currentTopic.level, currentTopic.type);
        }
        renderLevelCards();
      }
    };
    
    async function onConfigChange(cfg) {
      config = { ...defaultConfig, ...cfg };
      
      const title = document.getElementById('main-title');
      const subtitle = document.getElementById('main-subtitle');
      
      if (title) title.textContent = config.app_title || defaultConfig.app_title;
      if (subtitle) subtitle.textContent = config.app_subtitle || defaultConfig.app_subtitle;
    }
    
    // Initialize
    (async function init() {
      // Element SDK
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (cfg) => ({
          recolorables: [
            {
              get: () => cfg.primary_color || defaultConfig.primary_color,
              set: (v) => { cfg.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); }
            },
            {
              get: () => cfg.text_color || defaultConfig.text_color,
              set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
            },
            {
              get: () => cfg.accent_color || defaultConfig.accent_color,
              set: (v) => { cfg.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); }
            },
            {
              get: () => cfg.card_background || defaultConfig.card_background,
              set: (v) => { cfg.card_background = v; window.elementSdk.setConfig({ card_background: v }); }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => cfg.font_family || 'Montserrat',
            set: (v) => { cfg.font_family = v; window.elementSdk.setConfig({ font_family: v }); }
          },
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['app_title', cfg.app_title || defaultConfig.app_title],
          ['app_subtitle', cfg.app_subtitle || defaultConfig.app_subtitle]
        ])
      });
      
      // Data SDK
      const dataResult = await window.dataSdk.init(dataHandler);
      if (!dataResult.isOk) {
        console.error('Failed to initialize data SDK');
      }
      
      // Initial render
      renderLevelCards();
      updateAdminButton();
      updateFilterCount();
      
      // Search functionality
      document.getElementById('search-input').addEventListener('input', renderLevelCards);
      
      // Close popup on overlay click
      document.getElementById('popup-container').addEventListener('click', (e) => {
        if (e.target.id === 'popup-container') {
          hidePopup();
        }
      });
    })();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c196ea3a2cf2540',t:'MTc2OTAyNTk4Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
