<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Admin lecciÃ³n | AquiVivo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&family=Playfair+Display:wght@700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body data-page="lessonadmin">
  <div id="appHeader"></div>

  <div class="nav-glass">
    <div class="nav-inner">
      <div class="brand">
        <div class="logo-flag" aria-hidden="true"></div>
        <div class="name">AquiVivo</div>
      </div>
      <div class="nav-actions">
        <button class="btn btn-yellow" id="btnPublish" type="button">ğŸš€ Publicar</button>
        <a class="btn" id="btnBackCourse" href="#">â¬…ï¸ Curso</a>
        <a class="btn btn-yellow" id="btnOpenLesson" href="#">ğŸ“– Ver lecciÃ³n</a>
        <a class="btn" id="btnOpenExercises" href="#">ğŸ§© Admin ejercicios</a>
        <button class="btn btn-red" id="btnLogout" type="button">Cerrar sesiÃ³n</button>
      </div>
    </div>
  </div>

  <main class="page">
    <div class="container">

      <div class="card">
        <h1>Admin â€” LecciÃ³n</h1>
        <p class="subtitle">AquÃ­ editas el contenido de la lecciÃ³n (HTML) y sus metadatos. Los ejercicios se gestionan en la pÃ¡gina de ejercicios.</p>
        <div class="metaRow">
          <span class="pill pill-yellow" id="pillLevel">Nivel: â€”</span>
          <span class="pill" id="pillTopic">Tema: â€”</span>
          <span class="pill" id="pillDoc">Doc: â€”</span>
          <span class="pill" id="pillPub">â€”</span>
        </div>
      </div>

      <div class="card" id="adminOnly" style="display:none;">
        <div class="sectionTitle">ğŸ§© Meta</div>
        <div class="formGrid">
          <div class="field">
            <label for="titleInput">TÃ­tulo</label>
            <input class="input" id="titleInput" placeholder="p. ej. Caso nominativo â€” podstawy" />
          </div>
          <div class="field">
            <label for="typeSelect">Tipo</label>
            <select class="select" id="typeSelect">
              <option value="">â€”</option>
              <option value="grammar">GramÃ¡tica</option>
              <option value="vocab">Vocabulario</option>
              <option value="practice">PrÃ¡ctica</option>
              <option value="mixed">Mixto</option>
            </select>
          </div>
          <div class="field" style="grid-column: 1 / -1;">
            <label for="descInput">DescripciÃ³n corta</label>
            <input class="input" id="descInput" placeholder="1â€“2 frases sobre la lecciÃ³n" />
          </div>
          <div class="field">
            <label for="durationInput">DuraciÃ³n (min)</label>
            <input class="input" id="durationInput" type="number" min="0" placeholder="p. ej. 45" />
          </div>
          <div class="field">
            <label for="publishedToggle">Publicado</label>
            <select class="select" id="publishedToggle">
              <option value="false">Borrador</option>
              <option value="true">Publicado</option>
            </select>
          </div>

          <!-- ===== BUILDER (step 1) ===== -->
          <div class="field" style="grid-column: 1 / -1;">
            <div class="sectionTitle" style="margin-top:6px;">âœ¨ Constructor por bloques (recomendado)</div>
            <div class="builderTop">
              <div class="builderBtns">
                <button class="miniBtn yellow" id="btnTplGrammar" type="button">ğŸ“š Plantilla: GramÃ¡tica</button>
                <button class="miniBtn yellow" id="btnTplVocab" type="button">ğŸ§  Plantilla: Vocabulario</button>
                <button class="miniBtn" id="btnTplPremium" type="button">ğŸ’ Premium</button>
                <button class="miniBtn" id="btnTplRepaso" type="button">ğŸ” Repaso/Test</button>
                <button class="miniBtn red" id="btnClearBlocks" type="button">ğŸ—‘ Limpiar</button>
              </div>
            </div>
            <div class="mutedTiny">Ordena con â¬†ï¸â¬‡ï¸. Cada bloque permite <b>tamaÃ±o</b> y <b>color</b>. ImÃ¡genes por URL (por ahora).</div>

            <div id="blocksList" class="blocksList"></div>

            <div class="hrLine"></div>
            <div class="inlineRow">
              <div class="field" style="min-width: 220px; flex:2;">
                <label>Modo HTML</label>
                <div class="mutedTiny">Si usas bloques, el HTML se genera solo. Si prefieres, puedes editar el HTML manualmente.</div>
              </div>
              <div class="field" style="min-width: 220px; flex:1;">
                <label for="htmlMode">Fuente</label>
                <select class="select" id="htmlMode">
                  <option value="auto">Auto (desde bloques)</option>
                  <option value="manual">Manual (editar HTML)</option>
                </select>
              </div>
              <div class="field" style="min-width: 220px; flex:1;">
                <label>&nbsp;</label>
                <button class="miniBtn" id="btnWrapHtml" type="button">ğŸ“¦ Convertir HTML â†’ 1 bloque</button>
              </div>
            </div>
          </div>

          <div class="field" style="grid-column: 1 / -1;">
            <label for="htmlArea">Contenido (HTML)</label>
            <textarea id="htmlArea" placeholder="<h2>...</h2>"></textarea>
            <div class="hintSmall">Tip: puedes pegar HTML con <code>&lt;h2&gt;</code>, listas, imÃ¡genes, tablas. Esto se mostrarÃ¡ en <b>lessonpage.html</b>.</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="btnLoad" type="button">ğŸ”„ Recargar</button>
          <button class="btn btn-yellow" id="btnSave" type="button">ğŸ’¾ Guardar</button>
        </div>
      </div>

      <div class="card" id="noAdmin" style="display:none;">
        <div class="sectionTitle">â›” Acceso denegado</div>
        <div class="hintSmall">Este panel es solo para admin.</div>
      </div>

      <div class="card">
        <div class="sectionTitle">ğŸ‘ï¸ Vista previa</div>
        <div class="previewBox">
          <div id="previewTitle" style="font-weight:900; font-size:18px; margin-bottom:8px;">â€”</div>
          <div id="previewDesc" style="opacity:.9; margin-bottom:10px;">â€”</div>
          <div id="previewBody" class="lessonHtml"></div>
        </div>
      </div>

      <div id="toast"></div>
    </div>
  </main>

  <script type="module" src="assets/js/pages/lessonadmin-page.js"></script>

  <!-- Right dock: add blocks + defaults -->
  <div class="addDock" id="addDock">
    <div class="addDockTitle">â• AÃ±adir bloque <span style="opacity:.75;">(siempre visible)</span></div>

    <div class="dockGrid">
      <button class="dockBtn" id="btnAddHeading" type="button">â• TÃ­tulo</button>
      <button class="dockBtn" id="btnAddText" type="button">â• Texto</button>
      <button class="dockBtn" id="btnAddImage" type="button">â• Imagen</button>
      <button class="dockBtn" id="btnAddTip" type="button">â• Tip</button>
      <button class="dockBtn" id="btnAddExample" type="button">â• Ejemplo</button>
      <button class="dockBtn" id="btnAddDivider" type="button">â• Separador</button>
    </div>

    <div class="dockDivider"></div>
    <div class="addDockTitle">ğŸ¨ Estilo por defecto</div>

    <label style="font-weight:900; font-size:12px; opacity:.9;">Color de texto</label>
    <select class="dockSelect" id="defaultTextColor">
      <option value="muted">Blanco / por defecto</option>
      <option value="yellow">Amarillo</option>
      <option value="blue">Azul</option>
      <option value="red">Rojo</option>
    </select>

    <label style="font-weight:900; font-size:12px; opacity:.9;">TamaÃ±o de texto</label>
    <select class="dockSelect" id="defaultTextSize">
      <option value="xs">XS</option>
      <option value="sm">S</option>
      <option value="md" selected>M</option>
      <option value="lg">L</option>
      <option value="xl">XL</option>
    </select>

    <label style="font-weight:900; font-size:12px; opacity:.9;">Color del bloque</label>
    <select class="dockSelect" id="defaultBlockBg">
      <option value="none" selected>Sin fondo</option>
      <option value="white">Blanco</option>
      <option value="yellow">Amarillo</option>
      <option value="blue">Azul</option>
      <option value="red">Rojo</option>
    </select>

    <div style="font-size:12px; opacity:.8; line-height:1.35;">
      Estos valores se aplican automÃ¡ticamente a los nuevos bloques (Texto/TÃ­tulo/Imagen).
    </div>
  </div>

  <script src="assets/js/layout.js"></script>
</body>
</html>
