<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Ejercicios | AquiVivo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700;900&display=swap"
      rel="stylesheet"
    />

    
    <link rel="stylesheet" href="assets/css/styles.css">
  <script src="assets/js/layout.js" type="module"></script>
</head>

  <body data-page="ejercicio">
  <div id="appHeader"></div>
<div class="sessionBar">
      SesiÃ³n activa: <strong id="sessionEmail">Cargando...</strong>
    </div>

    <main class="page">
      <div class="container">
      <div id="toast"></div>

      <div class="card">
        <div class="metaRow">
          <span class="pill pill-yellow" id="pillLevel">Nivel</span>
          <span class="pill pill-blue" id="pillType">Tipo</span>
          <span class="pill" id="pillSlug">slug</span>
          <span class="pill" id="pillCount">Ejercicios: 0</span>
          <span class="pill" id="pillProgress" style="background: rgba(252,209,22,0.16); border-color: rgba(252,209,22,0.35);">Progreso: 0%</span>
        </div>
        <div class="progressWrap" style="margin-top:10px">
          <div class="progressBar"><div class="progressFill" id="progressFill" style="width:0%"></div></div>
          <div class="progressText" id="progressText">0 / 0 completados</div>
        </div>

        <h1 id="topicTitle">Cargandoâ€¦</h1>
        <p class="subtitle" id="topicDesc">Cargandoâ€¦</p>

        <div class="metaRow" id="taskChips"></div>
      </div>

      <!-- Lesson content (from course_meta docId: LEVEL__topicSlug) -->
      <div id="lessonContentCard" class="lessonContentCard" style="display:none">
        <div class="lessonContentTitle">
          <h3>ðŸ“˜ LecciÃ³n â€” materiales del tema</h3>
          <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center">
            <a class="btn" id="btnOpenLessonPage" href="#">ðŸ“– Abrir lecciÃ³n (pÃ¡gina)</a>
          </div>
        </div>

        <div id="lessonContentBody" class="lessonText"></div>
        <div id="lessonContentEmpty" class="lessonEmpty" style="display:none">TodavÃ­a no hay contenido de lecciÃ³n para este tema.</div>
      </div>

      <div class="sectionTitle">ðŸ§© Ejercicios</div>

      <div class="card" id="filtersCard" style="padding:14px 14px 12px; margin-bottom:14px">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end">
          <div style="flex:1; min-width:220px">
            <label style="display:block; font-weight:700; margin-bottom:6px">Buscar</label>
            <input id="filterSearch" placeholder="Szukaj po treÅ›ci / odpowiedziâ€¦" />
          </div>

          <div style="min-width:190px">
            <label style="display:block; font-weight:700; margin-bottom:6px">Typ</label>
            <select id="filterType"></select>
          </div>

          <div style="min-width:190px">
            <label style="display:block; font-weight:700; margin-bottom:6px">Kategoria</label>
            <select id="filterCategory">
              <option value="">Wszystko</option>
              <option value="grammar">GramÃ¡tica</option>
              <option value="vocab">Vocabulario</option>
              <option value="both">GramÃ¡tica + vocabulario</option>
            </select>
          </div>

          <button class="btn" id="btnClearFilters" type="button">ðŸ§¹ WyczyÅ›Ä‡</button>

          <div style="margin-left:auto; display:flex; gap:10px; align-items:center; flex-wrap:wrap">
            <label style="display:flex; gap:8px; align-items:center; user-select:none; font-weight:700">
              <input id="toggleReorder" type="checkbox" style="transform:scale(1.15)" />
              Tryb sortowania (drag&drop)
            </label>
            <button class="btn btn-yellow" id="btnSaveOrder" type="button" style="display:none">ðŸ’¾ Zapisz kolejnoÅ›Ä‡</button>
          </div>
        </div>

        <div class="smallNote" style="margin-top:8px; opacity:.95">
          Tip: w trybie sortowania przeciÄ…gaj kafelki. Zapis kolejnoÅ›ci aktualizuje pole <b>order</b> w Firestore.
        </div>
      </div>

      <div id="exerciseList"></div>

      <div id="emptyExercises" class="card" style="display:none; opacity:0.95">
        <div class="muted">
          TodavÃ­a no hay ejercicios para este tema.
        </div>
        <div class="smallNote" style="margin-top:10px">
          Si eres admin, agrega el primero abajo ðŸ‘‡
        </div>
      </div>

      <!-- Admin moved to ejercicioadmin.html -->
      <div id="adminWrap" class="card adminWrap" style="display:none"></div>
      </div>
    </main>

    
    <!-- Preview modal -->
    <div id="previewModal" class="modal" style="display:none">
      <div class="modalBackdrop" id="previewBackdrop"></div>
      <div class="modalBox card">
        <div style="display:flex; gap:10px; align-items:center; justify-content:space-between">
          <div class="sectionTitle" style="margin:0">ðŸ‘€ PodglÄ…d (uczeÅ„)</div>
          <button class="btn" id="btnClosePreview" type="button">âœ–</button>
        </div>

        <div id="previewBody" style="margin-top:10px"></div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; align-items:center">
          <button class="btn btn-yellow" id="btnCheckPreview" type="button">âœ… SprawdÅº</button>
          <span id="previewResult" class="pill" style="display:none"></span>
        </div>

        <div class="smallNote" style="margin-top:10px; opacity:.95">
          Ten podglÄ…d jest po to, Å¼eby szybko sprawdziÄ‡ czy treÅ›Ä‡ i odpowiedÅº sÄ… spÃ³jne.
        </div>
      </div>
    </div>

  <script type="module" src="assets/js/pages/ejercicio-page.js"></script>
</body>
</html>
